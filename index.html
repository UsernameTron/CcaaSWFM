<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Pete Connor — Operations Intelligence Architecture</title>
<meta name="description" content="Interactive technical portfolio: Unified Operations Intelligence, Systemic-First Quality Intelligence, and Predictive Intelligence architectures.">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');
  *{margin:0;padding:0;box-sizing:border-box}
  :root{
    --bg:#09090b;--surface:#111113;--surface-alt:#18181b;
    --border:#27272a;--border-hover:#3f3f46;
    --text:#fafafa;--text-secondary:#a1a1aa;--text-muted:#71717a;
    --cyan:#22d3ee;--cyan-muted:rgba(34,211,238,0.08);--cyan-border:rgba(34,211,238,0.25);
    --rose:#fb7185;--rose-muted:rgba(251,113,133,0.08);--rose-border:rgba(251,113,133,0.25);
    --success:#4ade80;--error:#ef4444;--warning:#fbbf24;--purple:#c084fc;
    --amber:#f59e0b;--amber-muted:rgba(245,158,11,0.08);--amber-border:rgba(245,158,11,0.25);
    --emerald:#10b981;--emerald-muted:rgba(16,185,129,0.08);--emerald-border:rgba(16,185,129,0.25);
    --mono:'JetBrains Mono',monospace;--sans:'Plus Jakarta Sans',system-ui,sans-serif;
  }
  body{background:var(--bg);color:var(--text);font-family:var(--sans);min-height:100vh;-webkit-tap-highlight-color:transparent}
  .global-nav{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(9,9,11,0.92);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:0 32px;display:flex;justify-content:space-between;align-items:center;height:52px}
  .nav-brand{display:flex;align-items:center;gap:12px}
  .nav-brand-mark{font-family:var(--mono);font-size:11px;font-weight:600;color:var(--cyan);letter-spacing:0.08em}
  .nav-brand-sep{color:var(--border);font-size:14px}
  .nav-brand-title{font-size:12px;color:var(--text-muted);font-weight:400}
  .nav-links{display:flex;gap:0}
  .nav-link{padding:16px 16px;font-size:10px;font-weight:500;letter-spacing:0.05em;color:var(--text-muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;text-transform:uppercase;user-select:none;text-decoration:none}
  .nav-link:hover{color:var(--text-secondary)}
  .nav-link.active-amber{color:var(--amber);border-bottom-color:var(--amber)}
  .nav-link.active-cyan{color:var(--cyan);border-bottom-color:var(--cyan)}
  .nav-link.active-rose{color:var(--rose);border-bottom-color:var(--rose)}
  .nav-link.active-emerald{color:var(--emerald);border-bottom-color:var(--emerald)}
  .page{display:none;padding-top:52px;min-height:100vh}
  .page.active{display:block}
  .page-header{border-bottom:1px solid var(--border);padding:20px 32px;display:flex;justify-content:space-between;align-items:flex-end}
  .ph-label{font-size:9px;font-weight:500;letter-spacing:0.12em;text-transform:uppercase;margin-bottom:4px}
  .ph-title{font-size:20px;font-weight:400}
  .ph-metrics{display:flex;gap:40px;align-items:baseline}
  .ph-val{font-family:var(--mono);font-size:26px;font-weight:600;letter-spacing:-0.02em}
  .ph-unit{font-size:11px;color:var(--text-muted);margin-left:6px}
  .sub-tabs{display:flex;border-bottom:1px solid var(--border);background:var(--surface);padding:0 32px}
  .sub-tab{padding:12px 24px;font-size:11px;font-weight:500;letter-spacing:0.05em;color:var(--text-muted);cursor:pointer;border-bottom:2px solid transparent;transition:all 0.2s;text-transform:uppercase;user-select:none}
  .sub-tab:hover{color:var(--text-secondary)}
  .sub-panel{display:none}.sub-panel.active{display:block}
  .panel-content{padding:28px 32px;max-width:1400px}
  .sl{font-size:9px;font-weight:500;letter-spacing:0.1em;color:var(--text-muted);text-transform:uppercase;margin-bottom:16px}

  /* P0: ARCHITECTURE OVERVIEW (AMBER) */
  .p0 .sub-tab.active{color:var(--amber);border-bottom-color:var(--amber)}
  .loop-container{position:relative;width:100%;max-width:900px;margin:0 auto 40px;padding:60px 20px}
  .arch-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:32px}
  .arch-card{padding:24px;background:var(--surface);border:1px solid var(--border);border-radius:8px;border-top:3px solid var(--amber)}
  .arch-card h3{font-size:13px;font-weight:600;margin-bottom:8px}
  .arch-card p{font-size:12px;color:var(--text-secondary);line-height:1.6}

  /* P2: UNIFIED INTELLIGENCE (CYAN) */
  .p2 .sub-tab.active{color:var(--cyan);border-bottom-color:var(--cyan)}
  .platform-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:32px}
  .platform-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:20px;cursor:pointer;transition:all 0.25s;position:relative;overflow:hidden}
  .platform-card::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--cyan);transform:scaleX(0);transition:transform 0.3s}
  .platform-card:hover{border-color:var(--border-hover)}
  .platform-card.selected{border-color:var(--cyan-border);background:var(--cyan-muted)}
  .platform-card.selected::after{transform:scaleX(1)}
  .platform-card.add-platform{border-style:dashed;border-color:var(--border-hover);background:transparent;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;min-height:160px}
  .platform-card.add-platform:hover{border-color:var(--cyan-border);background:var(--cyan-muted)}
  .platform-card.add-platform .pc-plus{font-size:28px;color:var(--text-muted);margin-bottom:8px;font-weight:300}
  .pc-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:14px;font-weight:600;margin-bottom:14px}
  .pc-name{font-size:15px;font-weight:600;margin-bottom:4px}
  .pc-role{font-size:11px;color:var(--text-muted);margin-bottom:12px}
  .pc-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .pc-stat-label{font-size:9px;color:var(--text-muted);letter-spacing:0.05em;text-transform:uppercase}
  .pc-stat-val{font-family:var(--mono);font-size:14px;font-weight:600;color:var(--cyan)}
  .endpoint-drawer{background:var(--surface);border:1px solid var(--border);border-radius:8px;margin-bottom:32px;overflow:hidden;max-height:0;opacity:0;transition:max-height 0.4s ease,opacity 0.3s ease}
  .endpoint-drawer.open{max-height:800px;opacity:1}
  .drawer-header{padding:16px 24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
  .drawer-title{font-size:13px;font-weight:600}
  .drawer-close{font-size:18px;color:var(--text-muted);cursor:pointer;padding:4px 8px;border-radius:4px;transition:color 0.2s;line-height:1}
  .drawer-close:hover{color:var(--text)}
  .drawer-body{padding:20px 24px}
  .endpoint-row{display:grid;grid-template-columns:1fr 80px 80px;gap:12px;padding:10px 0;border-bottom:1px solid var(--border);align-items:center}
  .endpoint-row:last-child{border-bottom:none}
  .ep-path{font-family:var(--mono);font-size:11px;color:var(--text-secondary);word-break:break-all}
  .ep-method{font-family:var(--mono);font-size:9px;text-align:center;padding:3px 8px;border-radius:3px;font-weight:600}
  .ep-method.get{background:rgba(74,222,128,0.1);color:var(--success)}
  .ep-method.post{background:rgba(34,211,238,0.1);color:var(--cyan)}
  .ep-method.webhook{background:rgba(251,191,36,0.1);color:var(--warning)}
  .ep-freq{font-family:var(--mono);font-size:10px;color:var(--text-muted);text-align:right}
  /* N+M Comparison */
  .nm-comparison{display:none;background:var(--surface);border:1px solid var(--cyan-border);border-radius:8px;padding:28px;margin-bottom:32px;animation:fadeSlideIn 0.4s ease}
  .nm-comparison.visible{display:block}
  @keyframes fadeSlideIn{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
  .nm-grid{display:grid;grid-template-columns:1fr 60px 1fr;gap:20px;align-items:start;margin-bottom:20px}
  .nm-col{text-align:center}
  .nm-col h4{font-size:12px;font-weight:600;margin-bottom:4px}
  .nm-col .nm-formula{font-family:var(--mono);font-size:11px;color:var(--text-muted);margin-bottom:12px}
  .nm-dots{display:flex;flex-wrap:wrap;gap:3px;justify-content:center;min-height:60px;padding:8px}
  .nm-dot{width:8px;height:8px;border-radius:2px;transition:all 0.3s}
  .nm-dot.existing{background:var(--border-hover)}
  .nm-dot.new{background:var(--error);animation:dotPop 0.3s ease forwards}
  .nm-vs{display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:14px;color:var(--text-muted);font-weight:600}
  @keyframes dotPop{from{transform:scale(0)}to{transform:scale(1)}}
  .nm-count{font-family:var(--mono);font-size:28px;font-weight:700;margin-top:8px}
  .nm-count.bad{color:var(--error)}.nm-count.good{color:var(--success)}
  .nm-delta{font-family:var(--mono);font-size:12px;margin-top:4px}
  .nm-insight{text-align:center;font-size:12px;color:var(--text-secondary);line-height:1.6;padding-top:16px;border-top:1px solid var(--border)}
  .flow-viz{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:32px;margin-bottom:32px;position:relative;min-height:140px}
  .flow-nodes{display:flex;justify-content:space-between;align-items:center;position:relative}
  .flow-node{width:140px;padding:16px;border-radius:8px;text-align:center;position:relative;z-index:2}
  .flow-node.source{background:var(--surface-alt);border:1px solid var(--border)}
  .flow-node.middleware{background:var(--cyan-muted);border:1px solid var(--cyan-border);width:180px}
  .flow-node.output{background:rgba(74,222,128,0.06);border:1px solid rgba(74,222,128,0.2)}
  .fn-label{font-size:9px;font-weight:500;letter-spacing:0.08em;text-transform:uppercase;margin-bottom:6px}
  .flow-node.source .fn-label{color:var(--text-muted)}
  .flow-node.middleware .fn-label{color:var(--cyan)}
  .flow-node.output .fn-label{color:var(--success)}
  .fn-name{font-size:13px;font-weight:600}
  .fn-detail{font-size:10px;color:var(--text-muted);margin-top:4px}
  .flow-pulse{position:absolute;top:50%;transform:translateY(-50%);width:8px;height:8px;background:var(--cyan);border-radius:50%;z-index:3;opacity:0;box-shadow:0 0 12px rgba(34,211,238,0.3)}
  .flow-pulse.animating{animation:flowPulse 2.5s ease-in-out infinite}
  .flow-pulse:nth-child(2){animation-delay:0.8s}
  .flow-pulse:nth-child(3){animation-delay:1.6s}
  @keyframes flowPulse{0%{opacity:0;left:16%}10%{opacity:1}45%{opacity:1;left:47%}55%{opacity:1;left:53%}90%{opacity:1}100%{opacity:0;left:84%}}
  .sim-grid{display:grid;grid-template-columns:1fr 400px;gap:24px;margin-bottom:24px}
  .sim-controls,.sim-result{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:24px}
  .sim-result{display:flex;flex-direction:column;justify-content:center}
  .sim-slider-group{margin-bottom:20px}
  .sim-slider-label{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .sim-slider-name{font-size:12px;color:var(--text-secondary)}
  .sim-slider-val{font-family:var(--mono);font-size:13px;font-weight:600;color:var(--cyan);min-width:60px;text-align:right}
  .sim-slider{width:100%;-webkit-appearance:none;appearance:none;height:4px;background:var(--border);border-radius:2px;outline:none}
  .sim-slider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;background:var(--cyan);border-radius:50%;cursor:pointer;box-shadow:0 0 8px rgba(34,211,238,0.3)}
  .sim-classification{font-family:var(--mono);font-size:11px;letter-spacing:0.08em;text-transform:uppercase;padding:4px 12px;border-radius:4px;display:inline-block;margin-bottom:16px;width:fit-content;font-weight:600;transition:all 0.3s}
  .sim-classification.systemic{background:rgba(251,191,36,0.12);color:var(--warning);border:1px solid rgba(251,191,36,0.3)}
  .sim-classification.staffing{background:rgba(251,113,133,0.12);color:var(--rose);border:1px solid rgba(251,113,133,0.3)}
  .sim-classification.capacity{background:rgba(239,68,68,0.12);color:var(--error);border:1px solid rgba(239,68,68,0.3)}
  .sim-classification.process{background:rgba(192,132,252,0.12);color:var(--purple);border:1px solid rgba(192,132,252,0.3)}
  .sim-classification.normal{background:rgba(74,222,128,0.12);color:var(--success);border:1px solid rgba(74,222,128,0.3)}
  .sim-diagnosis{font-size:15px;font-weight:600;margin-bottom:8px}
  .sim-explanation{font-size:12px;color:var(--text-secondary);line-height:1.6}
  .sim-signals{margin-top:16px;padding-top:16px;border-top:1px solid var(--border)}
  .sim-signal-row{display:flex;justify-content:space-between;padding:6px 0}
  .sim-signal-name{font-size:11px;color:var(--text-muted)}
  .sim-signal-status{font-family:var(--mono);font-size:11px;font-weight:600}
  .sim-signal-status.up{color:var(--error)}.sim-signal-status.down{color:var(--warning)}.sim-signal-status.ok{color:var(--success)}
  /* Financial Impact */
  .fi-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px}
  .fi-panel{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:24px}
  .fi-field{margin-bottom:16px}
  .fi-label{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .fi-label-name{font-size:12px;color:var(--text-secondary)}
  .fi-label-val{font-family:var(--mono);font-size:13px;font-weight:600;color:var(--cyan)}
  .fi-slider{width:100%;-webkit-appearance:none;appearance:none;height:4px;background:var(--border);border-radius:2px;outline:none}
  .fi-slider::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;background:var(--cyan);border-radius:50%;cursor:pointer;box-shadow:0 0 6px rgba(34,211,238,0.3)}
  .fi-output-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .fi-output-card{padding:20px;border-radius:8px;border-left:3px solid var(--cyan);background:rgba(34,211,238,0.03)}
  .fi-output-card.total{grid-column:1/-1;border-left-color:var(--success);background:rgba(74,222,128,0.03);text-align:center}
  .fi-card-label{font-size:9px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;color:var(--text-muted);margin-bottom:8px}
  .fi-card-val{font-family:var(--mono);font-size:24px;font-weight:700;color:var(--cyan)}
  .fi-output-card.total .fi-card-val{font-size:32px;color:var(--success)}
  .fi-card-detail{font-size:11px;color:var(--text-muted);margin-top:4px}

  /* P3: QUALITY INTELLIGENCE (ROSE) */
  .p3 .sub-tab.active{color:var(--rose);border-bottom-color:var(--rose)}
  .scenario-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:24px}
  .scenario-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:20px;cursor:pointer;transition:all 0.25s}
  .scenario-card:hover{border-color:var(--border-hover)}
  .scenario-card.selected{border-color:var(--rose-border);background:var(--rose-muted)}
  .sc-symptom{font-size:14px;font-weight:600;margin-bottom:6px}
  .sc-detail{font-size:12px;color:var(--text-secondary);line-height:1.5;margin-bottom:10px}
  .sc-data{display:flex;gap:16px;font-family:var(--mono);font-size:10px;color:var(--text-muted)}
  .sc-data span{display:flex;align-items:center;gap:4px}
  .engine-display{display:grid;grid-template-columns:1fr 380px;gap:24px;margin-bottom:24px}
  .gate-sequence{background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden}
  .gate{padding:16px 24px;border-bottom:1px solid var(--border);display:grid;grid-template-columns:80px 1fr 100px;align-items:center;gap:16px;transition:all 0.4s;opacity:0.35}
  .gate:last-child{border-bottom:none}
  .gate.checking{opacity:1;background:rgba(34,211,238,0.04)}
  .gate.passed{opacity:0.6}
  .gate.triggered{opacity:1;background:var(--rose-muted)}
  .gate-id{font-family:var(--mono);font-size:10px;letter-spacing:0.08em;color:var(--text-muted)}
  .gate.triggered .gate-id{color:var(--rose)}
  .gate.checking .gate-id{color:var(--cyan)}
  .gate-name{font-size:13px;font-weight:500}
  .gate-desc{font-size:11px;color:var(--text-secondary);margin-top:2px}
  .gate-status{font-family:var(--mono);font-size:10px;text-align:right;font-weight:600;letter-spacing:0.05em}
  .gate-status.pass{color:var(--success)}.gate-status.trigger{color:var(--rose)}
  .result-panel{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:24px;display:flex;flex-direction:column;min-height:420px}
  .result-waiting{flex:1;display:flex;align-items:center;justify-content:center;text-align:center;color:var(--text-muted);font-size:13px}
  .result-content{display:none}.result-content.visible{display:block}
  .result-class{font-family:var(--mono);font-size:11px;letter-spacing:0.08em;text-transform:uppercase;padding:5px 14px;border-radius:4px;display:inline-block;margin-bottom:16px;font-weight:600}
  .result-class.systemic{background:rgba(251,191,36,0.12);color:var(--warning);border:1px solid rgba(251,191,36,0.3)}
  .result-class.cohort{background:var(--rose-muted);color:var(--rose);border:1px solid var(--rose-border)}
  .result-class.individual{background:rgba(74,222,128,0.12);color:var(--success);border:1px solid rgba(74,222,128,0.3)}
  .result-title{font-size:16px;font-weight:600;margin-bottom:8px}
  .result-detail{font-size:12px;color:var(--text-secondary);line-height:1.7;margin-bottom:20px}
  .result-action{padding:14px;border-radius:6px;margin-bottom:12px}
  .result-action.do{border-left:3px solid var(--success);background:rgba(74,222,128,0.04)}
  .result-action.dont{border-left:3px solid var(--error);background:rgba(239,68,68,0.04)}
  .ra-label{font-size:9px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;margin-bottom:4px}
  .result-action.do .ra-label{color:var(--success)}
  .result-action.dont .ra-label{color:var(--error)}
  .ra-text{font-size:12px;color:var(--text-secondary);line-height:1.5}
  .coaching-blocked{font-family:var(--mono);font-size:11px;color:var(--error);background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);padding:10px 14px;border-radius:6px;margin-bottom:12px;text-align:center;font-weight:600;letter-spacing:0.05em}
  .coaching-allowed{font-family:var(--mono);font-size:11px;color:var(--success);background:rgba(74,222,128,0.08);border:1px solid rgba(74,222,128,0.2);padding:10px 14px;border-radius:6px;margin-bottom:12px;text-align:center;font-weight:600;letter-spacing:0.05em}
  .run-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 24px;background:var(--rose-muted);border:1px solid var(--rose-border);border-radius:6px;color:var(--rose);font-family:var(--mono);font-size:11px;font-weight:600;letter-spacing:0.05em;cursor:pointer;transition:all 0.2s;text-transform:uppercase;margin-bottom:24px}
  .run-btn:hover{background:rgba(251,113,133,0.15);border-color:var(--rose)}
  .run-btn:disabled{opacity:0.4;cursor:default}
  .scenario-card.builder{border-style:dashed;border-color:var(--border-hover);background:transparent;grid-column:1/-1}
  .scenario-card.builder:hover{border-color:var(--rose-border);background:var(--rose-muted)}
  .scenario-card.builder.selected{border-style:solid;border-color:var(--rose-border);background:var(--rose-muted)}
  .builder-icon{font-size:20px;margin-bottom:6px;opacity:0.6}
  .custom-builder{display:none;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:24px;margin-bottom:20px}
  .custom-builder.visible{display:block}
  .builder-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .builder-field{display:flex;flex-direction:column;gap:6px}
  .builder-label{font-size:10px;font-weight:500;letter-spacing:0.08em;text-transform:uppercase;color:var(--text-muted)}
  .builder-input{background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:10px 14px;color:var(--text);font-family:var(--mono);font-size:14px;outline:none;transition:border-color 0.2s;width:100%}
  .builder-input:focus{border-color:var(--rose-border)}
  .builder-toggle{display:flex;align-items:center;gap:12px;padding:8px 0}
  .toggle-switch{width:40px;height:22px;background:var(--border);border-radius:11px;position:relative;cursor:pointer;transition:background 0.2s;flex-shrink:0}
  .toggle-switch.on{background:var(--rose)}
  .toggle-switch::after{content:'';position:absolute;top:3px;left:3px;width:16px;height:16px;background:var(--text);border-radius:50%;transition:transform 0.2s}
  .toggle-switch.on::after{transform:translateX(18px)}
  .toggle-label{font-size:13px;color:var(--text-secondary)}
  .builder-divider{grid-column:1/-1;border-top:1px solid var(--border);margin:4px 0}
  .builder-section-label{grid-column:1/-1;font-size:9px;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--rose);margin-top:4px}
  /* Composite Scoring */
  .systemic-gate-bar{display:flex;align-items:center;gap:16px;padding:16px 20px;border-radius:8px;margin-bottom:24px;transition:all 0.4s}
  .systemic-gate-bar.blocked{background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.2)}
  .systemic-gate-bar.cleared{background:rgba(74,222,128,0.06);border:1px solid rgba(74,222,128,0.2)}
  .sgb-status{font-family:var(--mono);font-size:11px;font-weight:600;letter-spacing:0.06em;text-transform:uppercase;flex:1}
  .systemic-gate-bar.blocked .sgb-status{color:var(--error)}
  .systemic-gate-bar.cleared .sgb-status{color:var(--success)}
  .sgb-btn{padding:8px 18px;border-radius:6px;font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:0.05em;cursor:pointer;transition:all 0.2s;text-transform:uppercase;border:none}
  .sgb-btn.clear{background:rgba(74,222,128,0.12);color:var(--success);border:1px solid rgba(74,222,128,0.25)}
  .sgb-btn.clear:hover{background:rgba(74,222,128,0.2)}
  .sgb-btn.block{background:rgba(239,68,68,0.12);color:var(--error);border:1px solid rgba(239,68,68,0.25)}
  .sgb-btn.block:hover{background:rgba(239,68,68,0.2)}
  .cs-mode-toggle{display:flex;gap:0;margin-bottom:24px}
  .cs-mode-btn{padding:10px 20px;font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:0.05em;cursor:pointer;transition:all 0.2s;text-transform:uppercase;border:1px solid var(--border);background:var(--surface);color:var(--text-muted)}
  .cs-mode-btn:first-child{border-radius:6px 0 0 6px}
  .cs-mode-btn:last-child{border-radius:0 6px 6px 0}
  .cs-mode-btn.active{background:var(--rose-muted);border-color:var(--rose-border);color:var(--rose)}
  .cs-locked{opacity:0.25;pointer-events:none;filter:blur(1px);transition:all 0.4s}
  .cs-unlocked{opacity:1;pointer-events:auto;filter:none;transition:all 0.4s}
  .agent-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px}
  .agent-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:16px;transition:all 0.3s}
  .agent-card .ac-name{font-size:12px;font-weight:600;margin-bottom:4px}
  .agent-card .ac-score{font-family:var(--mono);font-size:22px;font-weight:700;margin-bottom:8px}
  .ac-bar{height:6px;border-radius:3px;display:flex;overflow:hidden;margin-bottom:8px}
  .ac-bar-seg{height:100%;transition:width 0.6s ease}
  .ac-tier{font-family:var(--mono);font-size:9px;font-weight:600;letter-spacing:0.06em;text-transform:uppercase;padding:3px 8px;border-radius:3px;display:inline-block}
  .ac-tier.monitor{background:rgba(74,222,128,0.1);color:var(--success)}
  .ac-tier.coaching{background:rgba(251,191,36,0.1);color:var(--warning)}
  .ac-tier.pip{background:rgba(239,68,68,0.1);color:var(--error)}
  .ac-tier.escalation{background:rgba(192,132,252,0.1);color:var(--purple)}
  .cs-weight-legend{display:flex;flex-wrap:wrap;gap:12px;padding:12px 0}
  .cs-legend-item{display:flex;align-items:center;gap:6px;font-size:10px;color:var(--text-muted)}
  .cs-legend-dot{width:10px;height:10px;border-radius:2px}

  /* P4: PREDICTIVE INTELLIGENCE (EMERALD) */
  .p4 .sub-tab.active{color:var(--emerald);border-bottom-color:var(--emerald)}
  .fc-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px}
  .fc-panel{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:24px}
  .fc-field{margin-bottom:16px}.fc-field:last-child{margin-bottom:0}
  .fc-label{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .fc-label-name{font-size:12px;color:var(--text-secondary)}
  .fc-label-val{font-family:var(--mono);font-size:13px;font-weight:600;color:var(--emerald)}
  .fc-slider{width:100%;-webkit-appearance:none;appearance:none;height:4px;background:var(--border);border-radius:2px;outline:none}
  .fc-slider::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;background:var(--emerald);border-radius:50%;cursor:pointer;box-shadow:0 0 6px rgba(16,185,129,0.3)}
  .fc-select{background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:10px 14px;color:var(--text);font-family:var(--mono);font-size:14px;outline:none;width:100%;cursor:pointer}
  .fc-select:focus{border-color:var(--emerald-border)}
  .fc-output-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .fc-output-card{padding:16px;border-left:3px solid var(--emerald);background:rgba(16,185,129,0.03);border-radius:0 8px 8px 0}
  .fc-output-card.staffing{border-left-color:var(--cyan)}
  .fc-output-card.gap{border-left-color:var(--error)}
  .fc-card-label{font-size:9px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;color:var(--text-muted);margin-bottom:6px}
  .fc-card-val{font-family:var(--mono);font-size:22px;font-weight:700;color:var(--emerald)}
  .fc-output-card.staffing .fc-card-val{color:var(--cyan)}
  .fc-card-detail{font-size:10px;color:var(--text-muted);margin-top:4px}
  .seasonal-chart{display:flex;align-items:flex-end;gap:4px;height:80px;padding:12px 0;margin-bottom:16px}
  .seasonal-bar{flex:1;border-radius:3px 3px 0 0;transition:all 0.4s;position:relative;min-width:0}
  .seasonal-bar .sb-label{position:absolute;bottom:-16px;left:50%;transform:translateX(-50%);font-family:var(--mono);font-size:8px;color:var(--text-muted)}
  .seasonal-bar.active{box-shadow:0 0 8px rgba(16,185,129,0.3)}
  /* Accuracy Workflow */
  .aw-chart{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:24px;margin-bottom:24px}
  .aw-bars{display:flex;align-items:flex-end;gap:4px;height:160px;margin-bottom:24px;padding:0 4px}
  .aw-week{flex:1;display:flex;gap:2px;align-items:flex-end;position:relative;min-width:0}
  .aw-bar{flex:1;border-radius:2px 2px 0 0;transition:all 0.4s;min-width:0}
  .aw-bar.forecast{background:rgba(16,185,129,0.2);border:1px solid rgba(16,185,129,0.3)}
  .aw-bar.actual{background:var(--emerald)}
  .aw-drift-zone{position:absolute;top:0;left:-2px;right:-2px;background:rgba(239,68,68,0.06);border:1px dashed rgba(239,68,68,0.2);border-radius:4px;display:none;pointer-events:none}
  .aw-week-label{position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);font-family:var(--mono);font-size:7px;color:var(--text-muted);white-space:nowrap}
  .aw-metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:16px}
  .aw-metric{text-align:center;padding:12px;background:var(--surface-alt);border-radius:6px}
  .aw-metric-val{font-family:var(--mono);font-size:20px;font-weight:700;color:var(--emerald)}
  .aw-metric-val.alert{color:var(--error)}
  .aw-metric-label{font-size:9px;color:var(--text-muted);letter-spacing:0.06em;text-transform:uppercase;margin-top:4px}
  .aw-drift-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 24px;border-radius:6px;font-family:var(--mono);font-size:11px;font-weight:600;letter-spacing:0.05em;cursor:pointer;transition:all 0.2s;text-transform:uppercase;border:1px solid var(--emerald-border);background:var(--emerald-muted);color:var(--emerald)}
  .aw-drift-btn:hover{background:rgba(16,185,129,0.15)}
  .aw-drift-btn.active{background:rgba(239,68,68,0.08);border-color:rgba(239,68,68,0.25);color:var(--error)}
  .aw-alert{display:none;margin-top:16px;padding:14px 20px;border-radius:8px;background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.2);font-family:var(--mono);font-size:11px;color:var(--error);text-align:center;font-weight:600;letter-spacing:0.04em}
  .aw-alert.visible{display:block;animation:fadeSlideIn 0.4s ease}

  /* SHARED */
  .code-block{background:var(--surface-alt);border:1px solid var(--border);border-radius:6px;overflow:hidden;margin-bottom:20px}
  .code-header{padding:10px 20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;cursor:pointer;transition:background 0.2s}
  .code-header:hover{background:rgba(255,255,255,0.02)}
  .code-label{font-family:var(--mono);font-size:10px;letter-spacing:0.06em;text-transform:uppercase}
  .p2 .code-label{color:var(--cyan)}.p3 .code-label{color:var(--rose)}.p4 .code-label{color:var(--emerald)}
  .code-toggle{font-size:11px;color:var(--text-muted);transition:transform 0.3s}
  .code-toggle.open{transform:rotate(180deg)}
  .code-body{padding:0 20px;max-height:0;overflow:hidden;transition:max-height 0.4s,padding 0.3s}
  .code-body.open{max-height:800px;padding:16px 20px}
  .code-body pre{font-family:var(--mono);font-size:11px;line-height:1.7;color:var(--text-secondary);white-space:pre;margin:0}
  .cm{color:var(--text-muted)}.kw{color:var(--cyan)}.st{color:var(--success)}.fn{color:var(--warning)}.nm{color:var(--purple)}.tp{color:var(--rose)}
  .p3 .kw{color:var(--rose)}.p4 .kw{color:var(--emerald)}
  .insight-row{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
  .insight-card{padding:18px;border-left:3px solid var(--cyan);background:var(--surface);border-radius:0 8px 8px 0}
  .p3 .insight-card{border-left-color:var(--rose)}
  .p4 .insight-card{border-left-color:var(--emerald)}
  .p0 .insight-card{border-left-color:var(--amber)}
  .ic-label{font-size:9px;font-weight:500;letter-spacing:0.1em;text-transform:uppercase;margin-bottom:8px}
  .p2 .ic-label{color:var(--cyan)}.p3 .ic-label{color:var(--rose)}.p4 .ic-label{color:var(--emerald)}.p0 .ic-label{color:var(--amber)}
  .ic-text{font-size:12px;color:var(--text-secondary);line-height:1.6}
  .ic-text strong{color:var(--text);font-weight:600}
  .tech-row{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:24px}
  .tech-tag{padding:4px 10px;background:var(--surface);border:1px solid var(--border);border-radius:4px;font-size:10px;font-family:var(--mono);color:var(--text-secondary)}
  .metrics-strip{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;padding:20px 32px;border-top:1px solid var(--border);background:var(--surface)}
  .ms-item{text-align:center}
  .ms-val{font-family:var(--mono);font-size:20px;font-weight:600;letter-spacing:-0.02em}
  .p2 .ms-val{color:var(--cyan)}.p3 .ms-val{color:var(--rose)}.p4 .ms-val{color:var(--emerald)}
  .ms-label{font-size:9px;color:var(--text-muted);letter-spacing:0.06em;text-transform:uppercase;margin-top:4px}
  @media(max-width:1024px){
    .platform-grid,.fi-grid,.fc-grid,.arch-cards{grid-template-columns:1fr}
    .sim-grid,.engine-display{grid-template-columns:1fr}
    .insight-row{grid-template-columns:1fr}
    .scenario-grid,.fi-output-grid,.fc-output-grid,.agent-grid{grid-template-columns:1fr 1fr}
    .metrics-strip,.aw-metrics{grid-template-columns:repeat(2,1fr)}
    .nm-grid{grid-template-columns:1fr}.nm-vs{padding:12px 0}
    .nav-link{padding:16px 10px;font-size:9px}
  }
</style>
</head>
<body>

<nav class="global-nav">
  <div class="nav-brand">
    <span class="nav-brand-mark">PC</span>
    <span class="nav-brand-sep">|</span>
    <span class="nav-brand-title">Operations Intelligence Architecture</span>
  </div>
  <div class="nav-links">
    <a class="nav-link active-amber" onclick="showPage('p0',this)">Architecture</a>
    <a class="nav-link" onclick="showPage('p2',this)">Unified Intelligence</a>
    <a class="nav-link" onclick="showPage('p3',this)">Quality Intelligence</a>
    <a class="nav-link" onclick="showPage('p4',this)">Predictive Intelligence</a>
  </div>
</nav>

<!-- ═══ PAGE 0: ARCHITECTURE OVERVIEW (AMBER) ═══ -->
<div class="page p0 active" id="page-p0">
  <div class="page-header">
    <div>
      <div class="ph-label" style="color:var(--amber)">System Architecture — Closed-Loop Intelligence</div>
      <div class="ph-title">Operations Intelligence Architecture</div>
    </div>
    <div class="ph-metrics">
      <div><span class="ph-val" style="color:var(--amber)">3</span><span class="ph-unit">intelligence layers</span></div>
      <div><span class="ph-val" style="color:var(--amber)">1</span><span class="ph-unit">closed loop</span></div>
      <div><span class="ph-val" style="color:var(--amber)">0</span><span class="ph-unit">vendor lock-in</span></div>
    </div>
  </div>
  <div class="panel-content" style="max-width:1000px;margin:0 auto">
    <div class="sl" style="text-align:center">Click any layer to explore its interactive tools</div>
    <div class="loop-container">
      <svg viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:auto">
        <defs>
          <path id="path-ab" d="M280,130 C420,40 520,40 600,170"/>
          <path id="path-bc" d="M600,250 C580,380 480,440 380,420"/>
          <path id="path-ca" d="M300,400 C200,360 160,260 220,170"/>
          <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="rgba(245,158,11,0.5)"/></marker>
        </defs>
        <use href="#path-ab" fill="none" stroke="var(--cyan)" stroke-width="2" opacity="0.3" marker-end="url(#arr)"/>
        <use href="#path-bc" fill="none" stroke="var(--rose)" stroke-width="2" opacity="0.3" marker-end="url(#arr)"/>
        <use href="#path-ca" fill="none" stroke="var(--emerald)" stroke-width="2" opacity="0.3" marker-end="url(#arr)"/>
        <circle fill="var(--cyan)" r="5"><animateMotion dur="4s" repeatCount="indefinite"><mpath href="#path-ab"/></animateMotion><animate attributeName="opacity" values="0;1;1;0" dur="4s" repeatCount="indefinite"/></circle>
        <circle fill="var(--rose)" r="5"><animateMotion dur="4s" repeatCount="indefinite" begin="1.3s"><mpath href="#path-bc"/></animateMotion><animate attributeName="opacity" values="0;1;1;0" dur="4s" repeatCount="indefinite" begin="1.3s"/></circle>
        <circle fill="var(--emerald)" r="5"><animateMotion dur="4s" repeatCount="indefinite" begin="2.6s"><mpath href="#path-ca"/></animateMotion><animate attributeName="opacity" values="0;1;1;0" dur="4s" repeatCount="indefinite" begin="2.6s"/></circle>
        <g style="cursor:pointer" onclick="showPage('p2',document.querySelectorAll('.nav-link')[1])">
          <rect x="140" y="120" width="200" height="100" rx="12" fill="var(--surface)" stroke="var(--cyan)" stroke-width="1.5" opacity="0.9"/>
          <rect x="140" y="120" width="200" height="4" rx="2" fill="var(--cyan)" opacity="0.6"/>
          <text x="240" y="156" text-anchor="middle" fill="var(--cyan)" font-family="JetBrains Mono,monospace" font-size="10" font-weight="500" letter-spacing="0.1em">DATA SPINE</text>
          <text x="240" y="178" text-anchor="middle" fill="var(--text)" font-family="Plus Jakarta Sans,sans-serif" font-size="14" font-weight="600">Unified Intelligence</text>
          <text x="240" y="198" text-anchor="middle" fill="var(--text-muted)" font-family="Plus Jakarta Sans,sans-serif" font-size="10">3 platforms → anomaly correlation</text>
        </g>
        <g style="cursor:pointer" onclick="showPage('p3',document.querySelectorAll('.nav-link')[2])">
          <rect x="490" y="140" width="200" height="100" rx="12" fill="var(--surface)" stroke="var(--rose)" stroke-width="1.5" opacity="0.9"/>
          <rect x="490" y="140" width="200" height="4" rx="2" fill="var(--rose)" opacity="0.6"/>
          <text x="590" y="176" text-anchor="middle" fill="var(--rose)" font-family="JetBrains Mono,monospace" font-size="10" font-weight="500" letter-spacing="0.1em">DIAGNOSTIC BRAIN</text>
          <text x="590" y="198" text-anchor="middle" fill="var(--text)" font-family="Plus Jakarta Sans,sans-serif" font-size="14" font-weight="600">Quality Intelligence</text>
          <text x="590" y="218" text-anchor="middle" fill="var(--text-muted)" font-family="Plus Jakarta Sans,sans-serif" font-size="10">5-gate classification engine</text>
        </g>
        <g style="cursor:pointer" onclick="showPage('p4',document.querySelectorAll('.nav-link')[3])">
          <rect x="260" y="340" width="200" height="100" rx="12" fill="var(--surface)" stroke="var(--emerald)" stroke-width="1.5" opacity="0.9"/>
          <rect x="260" y="340" width="200" height="4" rx="2" fill="var(--emerald)" opacity="0.6"/>
          <text x="360" y="376" text-anchor="middle" fill="var(--emerald)" font-family="JetBrains Mono,monospace" font-size="10" font-weight="500" letter-spacing="0.1em">PREDICTIVE SHIELD</text>
          <text x="360" y="398" text-anchor="middle" fill="var(--text)" font-family="Plus Jakarta Sans,sans-serif" font-size="14" font-weight="600">Predictive Intelligence</text>
          <text x="360" y="418" text-anchor="middle" fill="var(--text-muted)" font-family="Plus Jakarta Sans,sans-serif" font-size="10">Forecasting + drift detection</text>
        </g>
        <text font-size="9" fill="var(--text-muted)" font-family="JetBrains Mono,monospace"><textPath href="#path-ab" startOffset="45%" text-anchor="middle">signals →</textPath></text>
        <text font-size="9" fill="var(--text-muted)" font-family="JetBrains Mono,monospace"><textPath href="#path-bc" startOffset="45%" text-anchor="middle">classifications →</textPath></text>
        <text font-size="9" fill="var(--text-muted)" font-family="JetBrains Mono,monospace"><textPath href="#path-ca" startOffset="45%" text-anchor="middle">forecasts →</textPath></text>
      </svg>
    </div>
    <div class="arch-cards">
      <div class="arch-card"><h3 style="color:var(--amber)">Compounding Returns</h3><p>Better classification → better coaching → fewer failures → more resources for systemic prevention → reduced volume → improved SL without headcount. <strong style="color:var(--text)">The system gets better the longer it runs.</strong></p></div>
      <div class="arch-card"><h3 style="color:var(--amber)">Layer Interdependence</h3><p>The diagnostic brain needs the data spine's cross-platform visibility. The predictive layer needs historical baselines. <strong style="color:var(--text)">No vendor spans all three boundaries.</strong></p></div>
      <div class="arch-card"><h3 style="color:var(--amber)">Decision Cycle Compression</h3><p>Traditional: Monday review → Tuesday analysis → Wednesday coaching → Friday hope. This architecture: <strong style="color:var(--text)">same-day response</strong> by eliminating sequential dependencies.</p></div>
    </div>
    <div class="insight-row">
      <div class="insight-card"><div class="ic-label">Zero Capex Stack</div><div class="ic-text">Python 3.11, MCP SDK, asyncio, pandas, scipy, Redis, PostgreSQL, n8n. Runs against <strong>existing API endpoints</strong> already in platform licensing.</div></div>
      <div class="insight-card"><div class="ic-label">Domain Agnostic</div><div class="ic-text">Swap CCaaS, WFM, or ticketing vendors — write one connector, zero consumer changes. <strong>N+M complexity</strong> instead of N×M.</div></div>
      <div class="insight-card"><div class="ic-label">ML Bootstrap Path</div><div class="ic-text">Gate-based rules generate labeled training data. After 12+ months: <strong>supervised model</strong> trains on labels no one else in the industry has.</div></div>
    </div>
  </div>
</div>

<!-- ═══ PAGE 2: UNIFIED OPERATIONS (CYAN) ═══ -->
<div class="page p2" id="page-p2">
  <div class="page-header">
    <div>
      <div class="ph-label" style="color:var(--cyan)">Technical Architecture — Multi-Platform Integration</div>
      <div class="ph-title">Unified Operations Intelligence Engine</div>
    </div>
    <div class="ph-metrics">
      <div><span class="ph-val" style="color:var(--cyan)">3→1</span><span class="ph-unit">platforms unified</span></div>
      <div><span class="ph-val" style="color:var(--cyan)">$1M+</span><span class="ph-unit">annual savings</span></div>
      <div><span class="ph-val" style="color:var(--cyan)">&lt;15min</span><span class="ph-unit">anomaly detection</span></div>
    </div>
  </div>
  <div class="sub-tabs">
    <div class="sub-tab active" onclick="showSubTab('p2','connectors',this)">Connector Map</div>
    <div class="sub-tab" onclick="showSubTab('p2','arch',this)">MCP Architecture</div>
    <div class="sub-tab" onclick="showSubTab('p2','anomaly',this)">Anomaly Simulator</div>
    <div class="sub-tab" onclick="showSubTab('p2','financial',this)">Financial Impact</div>
  </div>
  <!-- Connectors + N+M -->
  <div class="sub-panel active" id="p2-connectors">
    <div class="panel-content">
      <div class="sl">Click a platform to inspect API endpoints — or click "Add Platform" to see integration scaling</div>
      <div class="platform-grid" style="grid-template-columns:repeat(4,1fr)">
        <div class="platform-card" onclick="selectPlatform('genesys')"><div class="pc-icon" style="background:rgba(34,211,238,0.1);color:var(--cyan)">GC</div><div class="pc-name">Genesys Cloud</div><div class="pc-role">CCaaS — Call routing, queue metrics, QA evaluations</div><div class="pc-stats"><div><div class="pc-stat-label">Endpoints</div><div class="pc-stat-val">4</div></div><div><div class="pc-stat-label">Fastest Poll</div><div class="pc-stat-val">5 min</div></div><div><div class="pc-stat-label">Auth</div><div class="pc-stat-val">OAuth2</div></div><div><div class="pc-stat-label">Rate Limit</div><div class="pc-stat-val">300/min</div></div></div></div>
        <div class="platform-card" onclick="selectPlatform('ukg')"><div class="pc-icon" style="background:rgba(192,132,252,0.1);color:var(--purple)">UK</div><div class="pc-name">UKG</div><div class="pc-role">WFM — Schedules, adherence, timecards, labor costs</div><div class="pc-stats"><div><div class="pc-stat-label">Endpoints</div><div class="pc-stat-val">3</div></div><div><div class="pc-stat-label">Fastest Poll</div><div class="pc-stat-val">daily</div></div><div><div class="pc-stat-label">Auth</div><div class="pc-stat-val">API Key</div></div><div><div class="pc-stat-label">Rate Limit</div><div class="pc-stat-val">60/min</div></div></div></div>
        <div class="platform-card" onclick="selectPlatform('helpdesk')"><div class="pc-icon" style="background:rgba(251,191,36,0.1);color:var(--warning)">HD</div><div class="pc-name">Helpdesk</div><div class="pc-role">Tickets — Escalations, categories, resolution tracking</div><div class="pc-stats"><div><div class="pc-stat-label">Endpoints</div><div class="pc-stat-val">2</div></div><div><div class="pc-stat-label">Fastest Poll</div><div class="pc-stat-val">real-time</div></div><div><div class="pc-stat-label">Auth</div><div class="pc-stat-val">Bearer</div></div><div><div class="pc-stat-label">Rate Limit</div><div class="pc-stat-val">120/min</div></div></div></div>
        <div class="platform-card add-platform" onclick="toggleNM()"><div class="pc-plus">+</div><div class="pc-name">Add Platform</div><div class="pc-role" style="margin-bottom:0">Any CCaaS, WFM, or Ticketing System</div></div>
      </div>
      <div class="nm-comparison" id="nm-comparison">
        <div class="nm-grid">
          <div class="nm-col"><h4 style="color:var(--error)">Traditional Integration (N×M)</h4><div class="nm-formula">3 platforms × 18 consumers → 4 × 18</div><div class="nm-dots" id="nm-dots-bad"></div><div class="nm-count bad" id="nm-count-bad">54</div><div class="nm-delta" style="color:var(--error)">+18 new integration points</div></div>
          <div class="nm-vs">vs</div>
          <div class="nm-col"><h4 style="color:var(--success)">MCP Integration (N+M)</h4><div class="nm-formula">3 connectors + 18 tools → 4 + 18</div><div class="nm-dots" id="nm-dots-good"></div><div class="nm-count good" id="nm-count-good">21</div><div class="nm-delta" style="color:var(--success)">+1 new connector</div></div>
        </div>
        <div class="nm-insight">Adding one platform requires <strong style="color:var(--text)">1 new connector</strong>. Zero consumer changes. Integration timeline: <strong style="color:var(--text)">weeks, not months</strong>.</div>
      </div>
      <div class="endpoint-drawer" id="endpoint-drawer"><div class="drawer-header"><div class="drawer-title" id="drawer-title"></div><div class="drawer-close" onclick="closePlatform()">✕</div></div><div class="drawer-body" id="drawer-body"></div></div>
      <div class="sl">Data Flow — Sources → Intelligence Layer → Outputs</div>
      <div class="flow-viz"><div class="flow-pulse animating"></div><div class="flow-pulse animating"></div><div class="flow-pulse animating"></div>
        <div class="flow-nodes">
          <div class="flow-node source"><div class="fn-label">Sources</div><div class="fn-name">3 Platforms</div><div class="fn-detail">9 API endpoints</div></div>
          <div style="flex:1;text-align:center;color:var(--text-muted);font-family:var(--mono);font-size:11px">extract → normalize → correlate</div>
          <div class="flow-node middleware"><div class="fn-label">MCP Server</div><div class="fn-name">Intelligence Layer</div><div class="fn-detail">Agent ID resolution &lt;2ms</div></div>
          <div style="flex:0.5;text-align:center;color:var(--text-muted);font-family:var(--mono);font-size:11px">→</div>
          <div class="flow-node output"><div class="fn-label">Outputs</div><div class="fn-name">18 Reports</div><div class="fn-detail">DPR, scorecard, cost, QA</div></div>
        </div>
      </div>
      <div class="insight-row">
        <div class="insight-card"><div class="ic-label">Why MCP Abstraction</div><div class="ic-text">Direct API wrappers create <strong>N×M complexity</strong>. MCP lets consumers describe what they need — the server handles extraction.</div></div>
        <div class="insight-card"><div class="ic-label">Agent ID Resolution</div><div class="ic-text">Genesys: <strong>UUID</strong>. UKG: <strong>employee number</strong>. Helpdesk: <strong>email</strong>. Redis cache maps any ID to canonical in <strong>&lt;2ms</strong>.</div></div>
        <div class="insight-card"><div class="ic-label">Platform-Agnostic</div><div class="ic-text">Swap Genesys for <strong>NICE CXone</strong>, add <strong>Cognigy</strong> and <strong>Observe.AI</strong> — the MCP layer remains identical.</div></div>
      </div>
    </div>
  </div>
  <!-- MCP Architecture -->
  <div class="sub-panel" id="p2-arch">
    <div class="panel-content">
      <div class="sl">MCP Server — Tool Registration Pattern</div>
      <div class="code-block"><div class="code-header" onclick="toggleCode('p2c1')"><div class="code-label">mcp_server.py — daily performance tool</div><div class="code-toggle open" id="toggle-p2c1">▼</div></div>
        <div class="code-body open" id="p2c1"><pre><span class="kw">from</span> mcp.server <span class="kw">import</span> Server
<span class="kw">from</span> mcp.types <span class="kw">import</span> Tool, TextContent

server = Server(<span class="st">"ops-intelligence"</span>)

<span class="kw">@server.tool</span>()
<span class="kw">async def</span> <span class="fn">get_daily_performance</span>(date: str) -> <span class="tp">list</span>[TextContent]:
    <span class="cm">"""Fetch and correlate daily metrics across all platforms."""</span>
    ccaas, wfm, tickets = <span class="kw">await</span> asyncio.<span class="fn">gather</span>(
        genesys.<span class="fn">get_interactions</span>(date),
        ukg.<span class="fn">get_timecards</span>(date),
        helpdesk.<span class="fn">get_tickets</span>(date)
    )
    perf = <span class="fn">build_unified_model</span>(ccaas, wfm, tickets)
    anomalies = <span class="fn">detect_anomalies</span>(perf, baseline=<span class="fn">get_rolling_30d</span>(date))
    <span class="kw">return</span> [TextContent(text=perf.<span class="fn">to_report</span>(anomalies))]</pre></div></div>
      <div class="sl">Technology Stack</div>
      <div class="tech-row"><span class="tech-tag">Python 3.11</span><span class="tech-tag">MCP SDK</span><span class="tech-tag">asyncio</span><span class="tech-tag">Genesys Cloud API</span><span class="tech-tag">UKG API</span><span class="tech-tag">REST / Webhooks</span><span class="tech-tag">Redis</span><span class="tech-tag">PostgreSQL</span><span class="tech-tag">pandas</span><span class="tech-tag">scipy (Erlang C)</span><span class="tech-tag">n8n</span></div>
    </div>
  </div>
  <!-- Anomaly Sim -->
  <div class="sub-panel" id="p2-anomaly">
    <div class="panel-content">
      <div class="sl">Live Anomaly Correlation — Adjust Metrics to See Classification</div>
      <div class="sim-grid">
        <div class="sim-controls">
          <div class="sim-slider-group"><div class="sim-slider-label"><span class="sim-slider-name">AHT (deviation)</span><span class="sim-slider-val" id="val-aht">+0%</span></div><input type="range" class="sim-slider" id="slider-aht" min="0" max="80" value="0" oninput="updateSim()"></div>
          <div class="sim-slider-group"><div class="sim-slider-label"><span class="sim-slider-name">Ticket Volume (vs. baseline)</span><span class="sim-slider-val" id="val-tickets">1.0x</span></div><input type="range" class="sim-slider" id="slider-tickets" min="50" max="300" value="100" oninput="updateSim()"></div>
          <div class="sim-slider-group"><div class="sim-slider-label"><span class="sim-slider-name">Schedule Adherence</span><span class="sim-slider-val" id="val-adherence">92%</span></div><input type="range" class="sim-slider" id="slider-adherence" min="50" max="98" value="92" oninput="updateSim()"></div>
          <div class="sim-slider-group"><div class="sim-slider-label"><span class="sim-slider-name">Call Volume (deviation)</span><span class="sim-slider-val" id="val-volume">+0%</span></div><input type="range" class="sim-slider" id="slider-volume" min="0" max="100" value="0" oninput="updateSim()"></div>
          <div class="sim-slider-group"><div class="sim-slider-label"><span class="sim-slider-name">Service Level</span><span class="sim-slider-val" id="val-sl">80%</span></div><input type="range" class="sim-slider" id="slider-sl" min="30" max="95" value="80" oninput="updateSim()"></div>
          <div class="sim-slider-group"><div class="sim-slider-label"><span class="sim-slider-name">FCR (deviation)</span><span class="sim-slider-val" id="val-fcr">0%</span></div><input type="range" class="sim-slider" id="slider-fcr" min="-30" max="5" value="0" oninput="updateSim()"></div>
        </div>
        <div class="sim-result">
          <div class="sim-classification normal" id="sim-class">NORMAL OPERATIONS</div>
          <div class="sim-diagnosis" id="sim-diag">All metrics within baseline parameters</div>
          <div class="sim-explanation" id="sim-expl">No anomaly detected. Cross-platform correlation shows aligned signals.</div>
          <div class="sim-signals">
            <div class="sim-signal-row"><span class="sim-signal-name">AHT</span><span class="sim-signal-status ok" id="sig-aht">NORMAL</span></div>
            <div class="sim-signal-row"><span class="sim-signal-name">Tickets</span><span class="sim-signal-status ok" id="sig-tickets">NORMAL</span></div>
            <div class="sim-signal-row"><span class="sim-signal-name">Adherence</span><span class="sim-signal-status ok" id="sig-adh">NORMAL</span></div>
            <div class="sim-signal-row"><span class="sim-signal-name">Volume</span><span class="sim-signal-status ok" id="sig-vol">NORMAL</span></div>
            <div class="sim-signal-row"><span class="sim-signal-name">Service Level</span><span class="sim-signal-status ok" id="sig-sl">ON TARGET</span></div>
            <div class="sim-signal-row"><span class="sim-signal-name">FCR</span><span class="sim-signal-status ok" id="sig-fcr">NORMAL</span></div>
          </div>
        </div>
      </div>
      <div class="insight-row">
        <div class="insight-card"><div class="ic-label">Why Multi-Signal</div><div class="ic-text">Single-metric alerts = <strong>noise</strong>. AHT↑ + Tickets↑ + Adherence→ is a <strong>system latency signature</strong>.</div></div>
        <div class="insight-card"><div class="ic-label">Erlang C Integration</div><div class="ic-text">CAPACITY anomaly triggers automatic <strong>staffing recalculation</strong> using live data.</div></div>
        <div class="insight-card"><div class="ic-label">Action Routing</div><div class="ic-text">SYSTEMIC → platform team. STAFFING → WFM. CAPACITY → Erlang recalc. Classification determines <strong>who</strong> gets the alert.</div></div>
      </div>
    </div>
  </div>
  <!-- Financial Impact -->
  <div class="sub-panel" id="p2-financial">
    <div class="panel-content">
      <div class="sl">Input your center's parameters — see quantified savings in real time</div>
      <div class="fi-grid">
        <div class="fi-panel">
          <div class="fi-field"><div class="fi-label"><span class="fi-label-name">Total Agents</span><span class="fi-label-val" id="fi-val-agents">120</span></div><input type="range" class="fi-slider" id="fi-agents" min="20" max="500" value="120" oninput="updateFI()"></div>
          <div class="fi-field"><div class="fi-label"><span class="fi-label-name">Blended Hourly Rate</span><span class="fi-label-val" id="fi-val-rate">$28</span></div><input type="range" class="fi-slider" id="fi-rate" min="15" max="45" value="28" oninput="updateFI()"></div>
          <div class="fi-field"><div class="fi-label"><span class="fi-label-name">Current Utilization</span><span class="fi-label-val" id="fi-val-util-curr">54%</span></div><input type="range" class="fi-slider" id="fi-util-curr" min="35" max="70" value="54" oninput="updateFI()"></div>
          <div class="fi-field"><div class="fi-label"><span class="fi-label-name">Target Utilization</span><span class="fi-label-val" id="fi-val-util-tgt">60%</span></div><input type="range" class="fi-slider" id="fi-util-tgt" min="45" max="75" value="60" oninput="updateFI()"></div>
          <div class="fi-field"><div class="fi-label"><span class="fi-label-name">Current AHT (min)</span><span class="fi-label-val" id="fi-val-aht-curr">10.7</span></div><input type="range" class="fi-slider" id="fi-aht-curr" min="80" max="140" value="107" oninput="updateFI()"></div>
          <div class="fi-field"><div class="fi-label"><span class="fi-label-name">Target AHT (min)</span><span class="fi-label-val" id="fi-val-aht-tgt">10.2</span></div><input type="range" class="fi-slider" id="fi-aht-tgt" min="70" max="130" value="102" oninput="updateFI()"></div>
          <div class="fi-field"><div class="fi-label"><span class="fi-label-name">Annual Turnover</span><span class="fi-label-val" id="fi-val-turnover">45%</span></div><input type="range" class="fi-slider" id="fi-turnover" min="10" max="90" value="45" oninput="updateFI()"></div>
          <div class="fi-field"><div class="fi-label"><span class="fi-label-name">Replacement Cost / Agent</span><span class="fi-label-val" id="fi-val-replace">$7,000</span></div><input type="range" class="fi-slider" id="fi-replace" min="3000" max="15000" value="7000" step="500" oninput="updateFI()"></div>
        </div>
        <div class="fi-panel">
          <div class="fi-output-grid">
            <div class="fi-output-card"><div class="fi-card-label">Utilization Savings</div><div class="fi-card-val" id="fi-out-util">$360K</div><div class="fi-card-detail" id="fi-out-util-detail">6 pts × 1.5 FTE equiv</div></div>
            <div class="fi-output-card"><div class="fi-card-label">AHT Savings</div><div class="fi-card-val" id="fi-out-aht">$93K</div><div class="fi-card-detail" id="fi-out-aht-detail">30s = 4.7% efficiency</div></div>
            <div class="fi-output-card"><div class="fi-card-label">Turnover Cost</div><div class="fi-card-val" id="fi-out-turnover">$378K</div><div class="fi-card-detail" id="fi-out-turnover-detail">54 departures × $7K</div></div>
            <div class="fi-output-card"><div class="fi-card-label">Turnover Reduction (5%)</div><div class="fi-card-val" id="fi-out-turnover-save">$42K</div><div class="fi-card-detail" id="fi-out-turnover-save-detail">6 fewer replacements/yr</div></div>
            <div class="fi-output-card total"><div class="fi-card-label">Combined Annual Opportunity</div><div class="fi-card-val" id="fi-out-total">$495K</div><div class="fi-card-detail" id="fi-out-pct">7.1% of annual labor spend</div></div>
          </div>
        </div>
      </div>
      <div class="insight-row">
        <div class="insight-card"><div class="ic-label">Board-Validated</div><div class="ic-text">Each utilization point ≈ <strong>1.5 FTE ≈ $40K</strong>. CFO independently calculated — <strong>matched this model exactly</strong>.</div></div>
        <div class="insight-card"><div class="ic-label">AHT Economics</div><div class="ic-text">Each <strong>30-second AHT improvement = $93K</strong> annual savings at default parameters.</div></div>
        <div class="insight-card"><div class="ic-label">Data Spine Required</div><div class="ic-text">Cost per contact needs <strong>both labor cost (WFM) and volume (CCaaS)</strong>. Without the unified data layer, this is manual and monthly.</div></div>
      </div>
    </div>
  </div>
  <div class="metrics-strip"><div class="ms-item"><div class="ms-val">12</div><div class="ms-label">API Endpoints</div></div><div class="ms-item"><div class="ms-val">&lt;2ms</div><div class="ms-label">ID Resolution</div></div><div class="ms-item"><div class="ms-val">18</div><div class="ms-label">Auto Reports</div></div><div class="ms-item"><div class="ms-val">104wk</div><div class="ms-label">Trend Depth</div></div><div class="ms-item"><div class="ms-val">20+hrs</div><div class="ms-label">Saved / Week</div></div></div>
</div>

<!-- ═══ PAGE 3: QUALITY INTELLIGENCE (ROSE) ═══ -->
<div class="page p3" id="page-p3">
  <div class="page-header">
    <div>
      <div class="ph-label" style="color:var(--rose)">Interactive Architecture — QA Classification Engine</div>
      <div class="ph-title">Systemic-First Quality Intelligence</div>
    </div>
    <div class="ph-metrics">
      <div><span class="ph-val" style="color:var(--rose)">5</span><span class="ph-unit">gate classification</span></div>
      <div><span class="ph-val" style="color:var(--rose)">p&lt;.05</span><span class="ph-unit">cohort detection</span></div>
      <div><span class="ph-val" style="color:var(--rose)">2-mode</span><span class="ph-unit">adaptive scoring</span></div>
    </div>
  </div>
  <div class="sub-tabs">
    <div class="sub-tab active" onclick="showSubTab('p3','scenarios',this)">Scenario Simulator</div>
    <div class="sub-tab" onclick="showSubTab('p3','engine',this)">Classification Engine</div>
    <div class="sub-tab" onclick="showSubTab('p3','scoring',this)">Agent Scoring</div>
    <div class="sub-tab" onclick="showSubTab('p3','decisions',this)">Architecture Decisions</div>
  </div>
  <!-- Scenarios -->
  <div class="sub-panel active" id="p3-scenarios">
    <div class="panel-content">
      <div class="sl">Select a QA failure scenario — watch the engine process through all five gates</div>
      <div class="scenario-grid">
        <div class="scenario-card" onclick="selectScenario(0)"><div class="sc-symptom">15 agents fail "accurate information"</div><div class="sc-detail">Standard QA: schedule 15 coaching sessions. But should you?</div><div class="sc-data"><span>Failing: <strong style="color:var(--rose)">15</strong></span><span>Criterion: <strong style="color:var(--rose)">Q7</strong></span></div></div>
        <div class="scenario-card" onclick="selectScenario(1)"><div class="sc-symptom">AHT spikes 40% on Tuesday</div><div class="sc-detail">Supervisors flag agents as "taking too long." 30+ coaching plans queued.</div><div class="sc-data"><span>AHT: <strong style="color:var(--rose)">+40%</strong></span><span>Affected: <strong style="color:var(--rose)">all</strong></span></div></div>
        <div class="scenario-card" onclick="selectScenario(2)"><div class="sc-symptom">Agent scores 62% on empathy</div><div class="sc-detail">Single agent, consistent low score. Peer average is 88%.</div><div class="sc-data"><span>Failing: <strong style="color:var(--rose)">1</strong></span><span>Peer avg: <strong style="color:var(--rose)">88%</strong></span></div></div>
        <div class="scenario-card" onclick="selectScenario(3)"><div class="sc-symptom">5 agents fail documentation — same hire month</div><div class="sc-detail">All hired Oct 2024. Same trainer. Individual plans generated.</div><div class="sc-data"><span>Failing: <strong style="color:var(--rose)">5</strong></span><span>Cohort: <strong style="color:var(--rose)">Oct 24</strong></span></div></div>
        <div class="scenario-card" onclick="selectScenario(4)"><div class="sc-symptom">12 agents fail hold-time compliance</div><div class="sc-detail">Exceeding max hold during interactions. Compliance team flagging.</div><div class="sc-data"><span>Failing: <strong style="color:var(--rose)">12</strong></span><span>Avg hold: <strong style="color:var(--rose)">4.2m</strong></span></div></div>
        <div class="scenario-card" onclick="selectScenario(5)"><div class="sc-symptom">2 agents miss call opening script</div><div class="sc-detail">Flagged across multiple evaluations. 96% of peers pass.</div><div class="sc-data"><span>Failing: <strong style="color:var(--rose)">2</strong></span><span>Peer rate: <strong style="color:var(--rose)">96%</strong></span></div></div>
        <div class="scenario-card builder" onclick="selectCustomBuilder()"><div class="builder-icon">⚙</div><div class="sc-symptom">Build Your Own Scenario</div><div class="sc-detail">Define custom parameters and run them through the five-gate engine.</div></div>
      </div>
      <div class="custom-builder" id="custom-builder">
        <div class="builder-grid">
          <div class="builder-section-label">Failure Scope</div>
          <div class="builder-field"><div class="builder-label">Agents failing</div><input type="number" class="builder-input" id="cb-failing" min="1" max="120" value="8"></div>
          <div class="builder-field"><div class="builder-label">Total evaluated</div><input type="number" class="builder-input" id="cb-total" min="1" max="200" value="60"></div>
          <div class="builder-divider"></div>
          <div class="builder-section-label">Gate Conditions</div>
          <div class="builder-field"><div class="builder-label">Gate 1 — System health</div><div class="builder-toggle"><div class="toggle-switch" id="cb-outage" onclick="toggleSwitch(this)"></div><span class="toggle-label">Platform outage / latency spike</span></div></div>
          <div class="builder-field"><div class="builder-label">Gate 3 — Process currency</div><div class="builder-toggle"><div class="toggle-switch" id="cb-kb" onclick="toggleSwitch(this)"></div><span class="toggle-label">KB / SOP updated within 7 days</span></div></div>
          <div class="builder-field"><div class="builder-label">Gate 4 — Routing accuracy</div><div class="builder-toggle"><div class="toggle-switch" id="cb-routing" onclick="toggleSwitch(this)"></div><span class="toggle-label">Skill mismatch detected</span></div></div>
          <div class="builder-field"><div class="builder-label">Gate 5 — Cohort</div><div class="builder-toggle"><div class="toggle-switch" id="cb-cohort" onclick="toggleSwitch(this)"></div><span class="toggle-label">Shared attribute</span></div><input type="number" class="builder-input" id="cb-cohort-pct" min="0" max="100" value="0" placeholder="Concentration %" style="margin-top:6px"></div>
        </div>
      </div>
      <button class="run-btn" id="run-btn" onclick="runEngine()" disabled>▶ Run Classification Engine</button>
      <div class="engine-display">
        <div class="gate-sequence">
          <div class="gate" id="g1"><div class="gate-id">GATE 01</div><div><div class="gate-name">System Health Check</div><div class="gate-desc">Platform outages, latency during eval window?</div></div><div class="gate-status pending" id="gs1">—</div></div>
          <div class="gate" id="g2"><div class="gate-id">GATE 02</div><div><div class="gate-name">Pattern Width</div><div class="gate-desc">3+ agents fail same criterion? Rate &gt; 25%?</div></div><div class="gate-status pending" id="gs2">—</div></div>
          <div class="gate" id="g3"><div class="gate-id">GATE 03</div><div><div class="gate-name">Process Currency</div><div class="gate-desc">SOP or KB updated within 7 days?</div></div><div class="gate-status pending" id="gs3">—</div></div>
          <div class="gate" id="g4"><div class="gate-id">GATE 04</div><div><div class="gate-name">Routing Accuracy</div><div class="gate-desc">Interactions correctly skill-matched?</div></div><div class="gate-status pending" id="gs4">—</div></div>
          <div class="gate" id="g5"><div class="gate-id">GATE 05</div><div><div class="gate-name">Cohort Analysis</div><div class="gate-desc">Shared hire date, trainer, shift?</div></div><div class="gate-status pending" id="gs5">—</div></div>
        </div>
        <div class="result-panel"><div class="result-waiting" id="rw">← Select a scenario and run the engine</div><div class="result-content" id="rc"></div></div>
      </div>
    </div>
  </div>
  <!-- Engine Code -->
  <div class="sub-panel" id="p3-engine">
    <div class="panel-content">
      <div class="sl">Core Algorithm — Gate-Based Failure Classification</div>
      <div class="code-block"><div class="code-header" onclick="toggleCode('p3c1')"><div class="code-label">systemic_detector.py — classification logic</div><div class="code-toggle open" id="toggle-p3c1">▼</div></div>
        <div class="code-body open" id="p3c1"><pre><span class="kw">def</span> <span class="fn">classify_qa_failure</span>(criterion_id, failing_agents, eval_window, ctx):
    <span class="cm"># GATE 1: System health</span>
    events = ctx.<span class="fn">get_system_events</span>(eval_window)
    has_outage = <span class="kw">any</span>(e.type <span class="kw">in</span> [<span class="st">"OUTAGE"</span>, <span class="st">"LATENCY_SPIKE"</span>] <span class="kw">for</span> e <span class="kw">in</span> events)
    n = <span class="fn">len</span>(failing_agents)
    rate = n / ctx.<span class="fn">agents_evaluated_on</span>(criterion_id, eval_window)
    <span class="kw">if</span> n >= <span class="nm">3</span> <span class="kw">and</span> has_outage:
        <span class="kw">return</span> <span class="tp">Classification</span>(type=<span class="st">"SYSTEMIC"</span>, coaching_blocked=<span class="kw">True</span>)
    <span class="cm"># GATE 2: Pattern width</span>
    <span class="kw">if</span> n >= <span class="nm">3</span> <span class="kw">and</span> rate > <span class="nm">0.25</span>:
        <span class="kw">return</span> <span class="tp">Classification</span>(type=<span class="st">"SYSTEMIC"</span>, coaching_blocked=<span class="kw">True</span>)
    <span class="cm"># GATE 5: Cohort pattern</span>
    cohort = <span class="fn">detect_cohort</span>(failing_agents, ctx.roster)
    <span class="kw">if</span> cohort.significant:
        <span class="kw">return</span> <span class="tp">Classification</span>(type=<span class="st">"COHORT"</span>)
    <span class="cm"># All gates passed → individual</span>
    <span class="kw">return</span> <span class="tp">Classification</span>(type=<span class="st">"INDIVIDUAL"</span>, coaching_blocked=<span class="kw">False</span>)</pre></div></div>
    </div>
  </div>
  <!-- Composite Scoring -->
  <div class="sub-panel" id="p3-scoring">
    <div class="panel-content">
      <div class="sl">Systemic gate must clear before individual scoring activates</div>
      <div class="systemic-gate-bar blocked" id="cs-gate-bar"><span class="sgb-status" id="cs-gate-status">⊘ BLOCKED — Systemic check required before individual analysis</span><button class="sgb-btn clear" id="cs-gate-btn" onclick="toggleSystemicGate()">Clear Systemic Check</button></div>
      <div id="cs-scoring-panel" class="cs-locked">
        <div class="cs-mode-toggle"><div class="cs-mode-btn active" onclick="setCSMode('full',this)">Full Data (6 dimensions)</div><div class="cs-mode-btn" onclick="setCSMode('partial',this)">Partial Data (5 dimensions)</div></div>
        <div class="cs-weight-legend" id="cs-legend"></div>
        <div class="agent-grid" id="agent-grid"></div>
        <div class="insight-row">
          <div class="insight-card"><div class="ic-label">Adaptive Weights</div><div class="ic-text">When dimensions are missing, the engine <strong>redistributes weights</strong> and normalizes to 1.0. Scores shift. Rankings may change.</div></div>
          <div class="insight-card"><div class="ic-label">Systemic-First Gate</div><div class="ic-text">Engine <strong>refuses to produce scores</strong> until environmental factors are cleared. No scoring during outages or volume spikes.</div></div>
          <div class="insight-card"><div class="ic-label">Intervention Tiers</div><div class="ic-text"><strong>Monitor</strong> (≥70) → <strong>Coaching</strong> (50–69) → <strong>PIP</strong> (35–49) → <strong>Escalation</strong> (&lt;35). Validated thresholds.</div></div>
        </div>
      </div>
    </div>
  </div>
  <!-- Architecture Decisions -->
  <div class="sub-panel" id="p3-decisions">
    <div class="panel-content">
      <div class="sl">Architecture Decisions — Why This Design</div>
      <div class="insight-row">
        <div class="insight-card"><div class="ic-label">Why Gates, Not ML</div><div class="ic-text">ML classifiers need <strong>labeled training data</strong>. Nobody labels QA failures as systemic vs individual. Gates produce those labels as a <strong>byproduct</strong>.</div></div>
        <div class="insight-card"><div class="ic-label">Why coaching_blocked</div><div class="ic-text">Without a hard gate, supervisors default to coaching. <strong>coaching_blocked = True</strong> removes that option when the problem isn't the person.</div></div>
        <div class="insight-card"><div class="ic-label">Deming's Insight</div><div class="ic-text">85% of quality problems originate in the <strong>system, not the worker</strong>. Contact centers have never systematically applied this. This engine does.</div></div>
      </div>
    </div>
  </div>
  <div class="metrics-strip"><div class="ms-item"><div class="ms-val">5</div><div class="ms-label">Classification Gates</div></div><div class="ms-item"><div class="ms-val">p&lt;.05</div><div class="ms-label">Cohort Detection</div></div><div class="ms-item"><div class="ms-val">6+1</div><div class="ms-label">Failure Scenarios</div></div><div class="ms-item"><div class="ms-val">6</div><div class="ms-label">Scoring Dimensions</div></div><div class="ms-item"><div class="ms-val">4</div><div class="ms-label">Intervention Tiers</div></div></div>
</div>

<!-- ═══ PAGE 4: PREDICTIVE INTELLIGENCE (EMERALD) ═══ -->
<div class="page p4" id="page-p4">
  <div class="page-header">
    <div>
      <div class="ph-label" style="color:var(--emerald)">Forecasting Engine — Demand Prediction + Staffing Optimization</div>
      <div class="ph-title">Predictive Operations Intelligence</div>
    </div>
    <div class="ph-metrics">
      <div><span class="ph-val" style="color:var(--emerald)">104wk</span><span class="ph-unit">validated dataset</span></div>
      <div><span class="ph-val" style="color:var(--emerald)">6.2%</span><span class="ph-unit">forecast MAPE</span></div>
      <div><span class="ph-val" style="color:var(--emerald)">&lt;2min</span><span class="ph-unit">Erlang C recalc</span></div>
    </div>
  </div>
  <div class="sub-tabs">
    <div class="sub-tab active" onclick="showSubTab('p4','forecast',this)">Demand Forecasting</div>
    <div class="sub-tab" onclick="showSubTab('p4','accuracy',this)">Accuracy Workflow</div>
  </div>
  <!-- Demand Forecasting -->
  <div class="sub-panel active" id="p4-forecast">
    <div class="panel-content">
      <div class="sl">Select a month and adjust parameters — watch the forecast decompose through seasonal + staffing layers</div>
      <div class="sl" style="margin-bottom:4px;color:var(--emerald)">12-Month Seasonal Curve (Monthly Volume Index)</div>
      <div class="seasonal-chart" id="seasonal-chart"></div>
      <div class="fc-grid">
        <div class="fc-panel">
          <div class="fc-field"><div class="fc-label"><span class="fc-label-name">Forecast Month</span><span class="fc-label-val" id="fc-val-month">July</span></div><select class="fc-select" id="fc-month" onchange="updateForecast()"><option value="0">January</option><option value="1">February</option><option value="2">March</option><option value="3">April</option><option value="4">May</option><option value="5">June</option><option value="6" selected>July</option><option value="7">August</option><option value="8">September</option><option value="9">October</option><option value="10">November</option><option value="11">December</option></select></div>
          <div class="fc-field"><div class="fc-label"><span class="fc-label-name">Growth Rate</span><span class="fc-label-val" id="fc-val-growth">+2%</span></div><input type="range" class="fc-slider" id="fc-growth" min="-5" max="15" value="2" oninput="updateForecast()"></div>
          <div class="fc-field"><div class="fc-label"><span class="fc-label-name">Service Level Target</span><span class="fc-label-val" id="fc-val-sl">80/120</span></div><input type="range" class="fc-slider" id="fc-sl" min="60" max="90" value="80" oninput="updateForecast()"></div>
          <div class="fc-field"><div class="fc-label"><span class="fc-label-name">Shrinkage</span><span class="fc-label-val" id="fc-val-shrink">28%</span></div><input type="range" class="fc-slider" id="fc-shrink" min="15" max="40" value="28" oninput="updateForecast()"></div>
          <div class="fc-field"><div class="fc-label"><span class="fc-label-name">AHT Override (min)</span><span class="fc-label-val" id="fc-val-aht">10.7</span></div><input type="range" class="fc-slider" id="fc-aht" min="80" max="140" value="107" oninput="updateForecast()"></div>
          <div class="fc-field"><div class="fc-label"><span class="fc-label-name">Current Headcount</span><span class="fc-label-val" id="fc-val-hc">120</span></div><input type="range" class="fc-slider" id="fc-hc" min="40" max="250" value="120" oninput="updateForecast()"></div>
        </div>
        <div class="fc-panel">
          <div class="fc-output-grid">
            <div class="fc-output-card"><div class="fc-card-label">Weekly Volume</div><div class="fc-card-val" id="fc-out-vol">14,835</div><div class="fc-card-detail" id="fc-out-vol-d">MVI 133.3 × 11,072 baseline</div></div>
            <div class="fc-output-card"><div class="fc-card-label">Peak Day (Mon)</div><div class="fc-card-val" id="fc-out-peak">2,621</div><div class="fc-card-detail">DOW multiplier: 1.237</div></div>
            <div class="fc-output-card staffing"><div class="fc-card-label">Required Agents (Peak Hr)</div><div class="fc-card-val" id="fc-out-agents">148</div><div class="fc-card-detail" id="fc-out-agents-d">Erlang C @ 80/120 SL target</div></div>
            <div class="fc-output-card staffing"><div class="fc-card-label">Required (Avg Hr)</div><div class="fc-card-val" id="fc-out-avg">112</div><div class="fc-card-detail">Includes shrinkage adjustment</div></div>
            <div class="fc-output-card gap" style="grid-column:1/-1"><div class="fc-card-label">Staffing Gap</div><div class="fc-card-val" id="fc-out-gap" style="font-size:28px">-28 agents</div><div class="fc-card-detail" id="fc-out-gap-d">Peak hour deficit against current headcount</div></div>
          </div>
        </div>
      </div>
      <div class="insight-row">
        <div class="insight-card"><div class="ic-label">Multiplicative Decomposition</div><div class="ic-text">Baseline × Monthly Index × DOW Multiplier × Hourly Distribution. <strong>Three layers of seasonal adjustment</strong> before Erlang C runs.</div></div>
        <div class="insight-card"><div class="ic-label">Validated Model</div><div class="ic-text">Trained on <strong>2024 data</strong>, predicted 2025: Pearson r=0.886, MAPE 6.2%. Peak and trough identified correctly.</div></div>
        <div class="insight-card"><div class="ic-label">Erlang C Staffing</div><div class="ic-text">Queueing theory calculates <strong>minimum agents</strong> for target SL at given arrival rate, handle time, and wait threshold.</div></div>
      </div>
    </div>
  </div>
  <!-- Accuracy Workflow -->
  <div class="sub-panel" id="p4-accuracy">
    <div class="panel-content">
      <div class="sl">20-Week Forecast vs. Actual — Toggle Drift to See Self-Correcting Detection</div>
      <div class="aw-chart">
        <div class="aw-bars" id="aw-bars"></div>
        <div style="display:flex;gap:16px;justify-content:center;margin-bottom:16px"><span style="display:flex;align-items:center;gap:6px;font-size:10px;color:var(--text-muted)"><span style="width:12px;height:12px;background:rgba(16,185,129,0.2);border:1px solid rgba(16,185,129,0.3);border-radius:2px;display:inline-block"></span> Forecast</span><span style="display:flex;align-items:center;gap:6px;font-size:10px;color:var(--text-muted)"><span style="width:12px;height:12px;background:var(--emerald);border-radius:2px;display:inline-block"></span> Actual</span></div>
        <div class="aw-metrics">
          <div class="aw-metric"><div class="aw-metric-val" id="aw-mape">6.2%</div><div class="aw-metric-label">Overall MAPE</div></div>
          <div class="aw-metric"><div class="aw-metric-val" id="aw-wmape">5.8%</div><div class="aw-metric-label">Weighted MAPE</div></div>
          <div class="aw-metric"><div class="aw-metric-val" id="aw-bias">+1.3%</div><div class="aw-metric-label">Bias</div></div>
          <div class="aw-metric"><div class="aw-metric-val" id="aw-ts">0.8</div><div class="aw-metric-label">Tracking Signal</div></div>
        </div>
        <div style="text-align:center"><button class="aw-drift-btn" id="aw-drift-btn" onclick="toggleDrift()">⚡ Simulate Structural Drift</button></div>
        <div class="aw-alert" id="aw-alert">⚠ DRIFT DETECTED: 4+ consecutive weeks above 15% MAPE. Model baseline requires recalibration.</div>
      </div>
      <div class="insight-row">
        <div class="insight-card"><div class="ic-label">Self-Correcting</div><div class="ic-text">Weekly workflow compares forecast to actual. When MAPE exceeds <strong>15% for 4+ weeks</strong>, recalibration alert fires. The model watches itself.</div></div>
        <div class="insight-card"><div class="ic-label">Tracking Signal</div><div class="ic-text">Cumulative bias ÷ MAD. When it exceeds <strong>±4.0</strong>, the model has systematic error — not random variance.</div></div>
        <div class="insight-card"><div class="ic-label">Production Safety Net</div><div class="ic-text">Most AI portfolios show a model built once. This shows it <strong>monitored continuously</strong> with automated drift detection.</div></div>
      </div>
    </div>
  </div>
  <div class="metrics-strip"><div class="ms-item"><div class="ms-val">104</div><div class="ms-label">Weeks Validated</div></div><div class="ms-item"><div class="ms-val">1.34M</div><div class="ms-label">Calls Analyzed</div></div><div class="ms-item"><div class="ms-val">0.886</div><div class="ms-label">Pearson r</div></div><div class="ms-item"><div class="ms-val">6.2%</div><div class="ms-label">Monthly MAPE</div></div><div class="ms-item"><div class="ms-val">12mo</div><div class="ms-label">ML Bootstrap</div></div></div>
</div>

<script>
// ═════ NAVIGATION ═════
const pageColors={p0:'amber',p2:'cyan',p3:'rose',p4:'emerald'};
function showPage(p,el){
  document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
  document.getElementById('page-'+p).classList.add('active');
  document.querySelectorAll('.nav-link').forEach(x=>x.className='nav-link');
  (el||event.target).classList.add('nav-link','active-'+pageColors[p]);
}
function showSubTab(page,tab,el){
  const c=document.getElementById('page-'+page);
  c.querySelectorAll('.sub-tab').forEach(t=>t.classList.remove('active'));
  c.querySelectorAll('.sub-panel').forEach(p=>p.classList.remove('active'));
  (el||event.target).classList.add('active');
  document.getElementById(page+'-'+tab).classList.add('active');
}
function toggleCode(id){document.getElementById(id).classList.toggle('open');document.getElementById('toggle-'+id).classList.toggle('open')}

// ═════ PLATFORM ENDPOINTS ═════
const endpoints={
  genesys:{title:'Genesys Cloud CX — API Endpoints',rows:[{p:'/api/v2/analytics/conversations/details/query',m:'post',f:'15 min'},{p:'/api/v2/analytics/queues/observations/query',m:'post',f:'5 min'},{p:'/api/v2/routing/agents/{id}/status',m:'get',f:'5 min'},{p:'/api/v2/quality/evaluations/query',m:'post',f:'daily'}]},
  ukg:{title:'UKG — API Endpoints',rows:[{p:'/api/v1/timekeeping/timecard/multi_read',m:'post',f:'daily'},{p:'/api/v1/scheduling/schedule/multi_read',m:'post',f:'daily'},{p:'/api/v1/timekeeping/actual_hours',m:'get',f:'daily'}]},
  helpdesk:{title:'Helpdesk — API Endpoints',rows:[{p:'/api/tickets?status=open&created_after={date}',m:'get',f:'30 min'},{p:'/webhooks/escalation',m:'webhook',f:'real-time'}]}
};
function selectPlatform(p){
  document.querySelectorAll('.platform-card:not(.add-platform)').forEach(c=>c.classList.remove('selected'));
  event.currentTarget.classList.add('selected');
  const e=endpoints[p],d=document.getElementById('endpoint-drawer');
  document.getElementById('drawer-title').textContent=e.title;
  document.getElementById('drawer-body').innerHTML=e.rows.map(r=>'<div class="endpoint-row"><div class="ep-path">'+r.p+'</div><div class="ep-method '+r.m+'">'+r.m.toUpperCase()+'</div><div class="ep-freq">'+r.f+'</div></div>').join('');
  d.classList.add('open');
}
function closePlatform(){document.getElementById('endpoint-drawer').classList.remove('open');document.querySelectorAll('.platform-card').forEach(c=>c.classList.remove('selected'))}

// ═════ N+M INTEGRATION ═════
let nmOpen=false;
function toggleNM(){
  nmOpen=!nmOpen;
  const comp=document.getElementById('nm-comparison');
  if(nmOpen){comp.classList.add('visible');renderNMDots()}else{comp.classList.remove('visible')}
}
function renderNMDots(){
  const bad=document.getElementById('nm-dots-bad'),good=document.getElementById('nm-dots-good');
  bad.innerHTML='';good.innerHTML='';
  document.getElementById('nm-count-bad').textContent='54';
  document.getElementById('nm-count-good').textContent='21';
  for(let i=0;i<54;i++){const d=document.createElement('div');d.className='nm-dot existing';bad.appendChild(d)}
  for(let i=0;i<21;i++){const d=document.createElement('div');d.className='nm-dot existing';good.appendChild(d)}
  setTimeout(()=>{
    for(let i=0;i<18;i++){const d=document.createElement('div');d.className='nm-dot new';d.style.animationDelay=i*30+'ms';bad.appendChild(d)}
    const d=document.createElement('div');d.className='nm-dot new';good.appendChild(d);
    document.getElementById('nm-count-bad').textContent='72';
    document.getElementById('nm-count-good').textContent='22';
  },400);
}

// ═════ ANOMALY SIMULATOR ═════
function updateSim(){
  const aht=+document.getElementById('slider-aht').value,tickets=+document.getElementById('slider-tickets').value/100,adh=+document.getElementById('slider-adherence').value,vol=+document.getElementById('slider-volume').value,sl=+document.getElementById('slider-sl').value,fcr=+document.getElementById('slider-fcr').value;
  document.getElementById('val-aht').textContent='+'+aht+'%';document.getElementById('val-tickets').textContent=tickets.toFixed(1)+'x';document.getElementById('val-adherence').textContent=adh+'%';document.getElementById('val-volume').textContent='+'+vol+'%';document.getElementById('val-sl').textContent=sl+'%';document.getElementById('val-fcr').textContent=fcr+'%';
  const sa=document.getElementById('sig-aht'),st=document.getElementById('sig-tickets'),sad=document.getElementById('sig-adh'),sv=document.getElementById('sig-vol'),ss=document.getElementById('sig-sl'),sf=document.getElementById('sig-fcr');
  sa.textContent=aht>20?'ELEVATED':'NORMAL';sa.className='sim-signal-status '+(aht>20?'up':'ok');
  st.textContent=tickets>1.4?'ELEVATED':'NORMAL';st.className='sim-signal-status '+(tickets>1.4?'up':'ok');
  sad.textContent=adh<85?'DEPRESSED':'NORMAL';sad.className='sim-signal-status '+(adh<85?'down':'ok');
  sv.textContent=vol>25?'ELEVATED':'NORMAL';sv.className='sim-signal-status '+(vol>25?'up':'ok');
  ss.textContent=sl<70?'BELOW TARGET':sl<80?'AT RISK':'ON TARGET';ss.className='sim-signal-status '+(sl<70?'up':sl<80?'down':'ok');
  sf.textContent=fcr<-10?'DECLINING':'NORMAL';sf.className='sim-signal-status '+(fcr<-10?'down':'ok');
  let cls='normal',diag='All metrics within baseline parameters',expl='No anomaly detected. Cross-platform correlation shows aligned signals.';
  if(aht>20&&tickets>1.4&&adh>=82){cls='systemic';diag='System Latency / Platform Issue';expl='AHT elevated with ticket surge but normal adherence — agents are struggling with tools, not attendance.'}
  else if(aht>20&&tickets<=1.2&&adh<85){cls='staffing';diag='Staffing / Coverage Gap';expl='AHT elevated with depressed adherence but normal tickets — agents overloaded due to insufficient coverage.'}
  else if(vol>30&&sl<70){cls='capacity';diag='Demand Exceeds Capacity';expl='Volume above forecast with service level collapse — Erlang C model inputs changed. Trigger staffing recalculation.'}
  else if(fcr<-12&&tickets>1.3&&aht<=15&&adh>=82){cls='process';diag='Process / Knowledge Gap';expl='FCR declining with ticket rise, but AHT and adherence normal — the process doesn\'t resolve the issue.'}
  document.getElementById('sim-class').className='sim-classification '+cls;
  document.getElementById('sim-class').textContent=cls==='normal'?'NORMAL OPERATIONS':cls.toUpperCase()+' ANOMALY';
  document.getElementById('sim-diag').textContent=diag;document.getElementById('sim-expl').textContent=expl;
}

// ═════ FINANCIAL IMPACT ═════
function updateFI(){
  const agents=+document.getElementById('fi-agents').value,rate=+document.getElementById('fi-rate').value,uC=+document.getElementById('fi-util-curr').value,uT=+document.getElementById('fi-util-tgt').value,aC=+document.getElementById('fi-aht-curr').value/10,aT=+document.getElementById('fi-aht-tgt').value/10,to=+document.getElementById('fi-turnover').value/100,rep=+document.getElementById('fi-replace').value;
  document.getElementById('fi-val-agents').textContent=agents;document.getElementById('fi-val-rate').textContent='$'+rate;document.getElementById('fi-val-util-curr').textContent=uC+'%';document.getElementById('fi-val-util-tgt').textContent=uT+'%';document.getElementById('fi-val-aht-curr').textContent=aC.toFixed(1);document.getElementById('fi-val-aht-tgt').textContent=aT.toFixed(1);document.getElementById('fi-val-turnover').textContent=Math.round(to*100)+'%';document.getElementById('fi-val-replace').textContent='$'+rep.toLocaleString();
  const annualLabor=agents*rate*2080,utilDelta=Math.max(0,uT-uC),fteEquiv=utilDelta*(agents/100),utilSave=fteEquiv*rate*2080,ahtDelta=Math.max(0,aC-aT),ahtPct=aC>0?ahtDelta/aC:0,ahtSave=ahtPct*annualLabor,turnoverCost=Math.round(agents*to)*rep,turnoverReduc=Math.round(agents*0.05)*rep,total=utilSave+ahtSave+turnoverReduc;
  document.getElementById('fi-out-util').textContent='$'+Math.round(utilSave/1000)+'K';document.getElementById('fi-out-util-detail').textContent=utilDelta+' pts × '+fteEquiv.toFixed(1)+' FTE equiv';
  document.getElementById('fi-out-aht').textContent='$'+Math.round(ahtSave/1000)+'K';document.getElementById('fi-out-aht-detail').textContent=(ahtDelta*60).toFixed(0)+'s = '+Math.round(ahtPct*100)+'% efficiency';
  document.getElementById('fi-out-turnover').textContent='$'+Math.round(turnoverCost/1000)+'K';document.getElementById('fi-out-turnover-detail').textContent=Math.round(agents*to)+' departures × $'+Math.round(rep/1000)+'K';
  document.getElementById('fi-out-turnover-save').textContent='$'+Math.round(turnoverReduc/1000)+'K';document.getElementById('fi-out-turnover-save-detail').textContent=Math.round(agents*0.05)+' fewer replacements/yr';
  document.getElementById('fi-out-total').textContent='$'+Math.round(total/1000)+'K';
  document.getElementById('fi-out-pct').textContent=(annualLabor>0?(total/annualLabor*100).toFixed(1):0)+'% of $'+(Math.round(annualLabor/100000)/10)+'M annual labor';
}

// ═════ QA SCENARIO ENGINE ═════
const scenarios=[
  {gates:[{s:'pass',l:'NO EVENT'},{s:'trigger',l:'25% RATE'},{s:'skip',l:'—'},{s:'skip',l:'—'},{s:'skip',l:'—'}],r:{ct:'systemic',cl:'SYSTEMIC — WIDESPREAD FAILURE',t:'15 agents failing same criterion (25% of evaluated)',d:'Gate 2: Failure rate exceeds 25% threshold. Pattern too wide for individual cause.',b:true,yes:'Initiate process review. Audit criterion. Schedule group training.',no:'Do NOT create 15 individual coaching plans.'}},
  {gates:[{s:'trigger',l:'PLATFORM EVENT'},{s:'skip',l:'—'},{s:'skip',l:'—'},{s:'skip',l:'—'},{s:'skip',l:'—'}],r:{ct:'systemic',cl:'SYSTEMIC — PLATFORM EVENT',t:'40% AHT spike correlated with system event on Tuesday',d:'Gate 1: Platform event confirmed during evaluation window.',b:true,yes:'Investigate platform event. Exclude affected evaluations.',no:'Do NOT coach 30+ agents for a system-caused AHT spike.'}},
  {gates:[{s:'pass',l:'NO EVENT'},{s:'pass',l:'1 AGENT'},{s:'pass',l:'NO CHANGE'},{s:'pass',l:'OK'},{s:'pass',l:'NO PATTERN'}],r:{ct:'individual',cl:'INDIVIDUAL — CONFIRMED GAP',t:'Single agent scores 62% on empathy — peer average 88%',d:'All five gates passed. Confirmed individual performance gap.',b:false,yes:'Generate targeted coaching plan with specific call examples.',no:'N/A — this IS the right time for coaching.'}},
  {gates:[{s:'pass',l:'NO EVENT'},{s:'pass',l:'5 AGENTS'},{s:'pass',l:'NO CHANGE'},{s:'pass',l:'OK'},{s:'trigger',l:'p < 0.05'}],r:{ct:'cohort',cl:'COHORT — SHARED ATTRIBUTE',t:'5 agents from Oct 2024 hire class, same trainer',d:'Gate 5: Chi-squared confirms statistically significant cohort concentration.',b:false,yes:'Targeted cohort intervention — review trainer curriculum.',no:'Do NOT create 5 individual PIPs. Root cause is upstream.'}},
  {gates:[{s:'pass',l:'NO EVENT'},{s:'trigger',l:'20% RATE'},{s:'skip',l:'—'},{s:'skip',l:'—'},{s:'skip',l:'—'}],r:{ct:'systemic',cl:'SYSTEMIC — WIDESPREAD FAILURE',t:'12 agents failing hold-time compliance simultaneously',d:'Gate 2: Pattern too wide for individual cause.',b:true,yes:'Audit hold system configuration. Check platform latency.',no:'Do NOT coach 12 agents for a likely configuration issue.'}},
  {gates:[{s:'pass',l:'NO EVENT'},{s:'pass',l:'2 AGENTS'},{s:'pass',l:'NO CHANGE'},{s:'pass',l:'OK'},{s:'pass',l:'NO PATTERN'}],r:{ct:'individual',cl:'INDIVIDUAL — CONFIRMED GAP',t:'2 agents consistently miss call opening — 96% peer pass rate',d:'All five gates passed. Confirmed individual gap.',b:false,yes:'Schedule focused coaching on call opening protocol.',no:'N/A — system verified clean.'}}
];
let selSc=-1,isCustom=false,running=false;
function selectScenario(i){document.querySelectorAll('.scenario-card').forEach(c=>c.classList.remove('selected'));document.querySelectorAll('.scenario-card')[i].classList.add('selected');selSc=i;isCustom=false;document.getElementById('custom-builder').classList.remove('visible');document.getElementById('run-btn').disabled=false;resetGates()}
function selectCustomBuilder(){document.querySelectorAll('.scenario-card').forEach(c=>c.classList.remove('selected'));document.querySelector('.scenario-card.builder').classList.add('selected');isCustom=true;selSc=-1;document.getElementById('custom-builder').classList.add('visible');document.getElementById('run-btn').disabled=false;resetGates()}
function toggleSwitch(el){el.classList.toggle('on')}
function buildCustomScenario(){
  const n=Math.max(1,+document.getElementById('cb-failing').value||1),total=Math.max(n,+document.getElementById('cb-total').value||60),rate=n/total;
  const ho=document.getElementById('cb-outage').classList.contains('on'),hk=document.getElementById('cb-kb').classList.contains('on'),hr=document.getElementById('cb-routing').classList.contains('on'),hc=document.getElementById('cb-cohort').classList.contains('on'),cp=+document.getElementById('cb-cohort-pct').value||0;
  const gates=[];let cl=null;
  if(n>=3&&ho){gates.push({s:'trigger',l:'PLATFORM EVENT'});cl={ct:'systemic',cl:'SYSTEMIC — PLATFORM EVENT',t:'System event with '+n+' agents affected',d:'Gate 1: Platform event confirmed.',b:true,yes:'Escalate platform issue. Exclude evaluations.',no:'Do NOT generate '+n+' individual plans.'}}else{gates.push({s:ho?'trigger':'pass',l:ho?'EVENT':'NO EVENT'})}
  if(!cl&&n>=3&&rate>0.25){gates.push({s:'trigger',l:Math.round(rate*100)+'% RATE'});cl={ct:'systemic',cl:'SYSTEMIC — WIDESPREAD',t:n+'/'+total+' agents ('+Math.round(rate*100)+'%)',d:'Gate 2: Rate exceeds 25%.',b:true,yes:'Process review. Group training.',no:'Do NOT create '+n+' individual plans.'}}else if(!cl){gates.push({s:'pass',l:n+' AGENT'+(n>1?'S':'')})}
  if(!cl&&n>=3&&hk){gates.push({s:'trigger',l:'KB UPDATED'});cl={ct:'systemic',cl:'SYSTEMIC — PROCESS CHANGE',t:'KB updated — '+n+' agents affected',d:'Gate 3: KB/SOP changed within 7 days.',b:true,yes:'Verify communication. Re-evaluate in 7 days.',no:'Do NOT coach on changed standard.'}}else if(!cl){gates.push({s:'pass',l:hk?'KB UPDATED':'NO CHANGE'})}
  if(!cl&&hr){gates.push({s:'trigger',l:'SKILL MISMATCH'});cl={ct:'systemic',cl:'SYSTEMIC — ROUTING ERROR',t:'Calls routed outside skill match',d:'Gate 4: Skill mismatch detected.',b:true,yes:'Audit ACD routing rules.',no:'Do NOT coach on misrouted calls.'}}else if(!cl){gates.push({s:'pass',l:'OK'})}
  if(!cl&&hc&&cp>=60){gates.push({s:'trigger',l:'p < 0.05'});cl={ct:'cohort',cl:'COHORT — SHARED ATTRIBUTE',t:'Concentration '+cp+'%',d:'Gate 5: Chi-squared confirms pattern.',b:false,yes:'Targeted cohort intervention.',no:'Do NOT create '+n+' individual PIPs.'}}else if(!cl){gates.push({s:'pass',l:hc?cp+'%':'NO PATTERN'})}
  if(!cl){cl={ct:'individual',cl:'INDIVIDUAL — CONFIRMED GAP',t:'Failure isolated to '+n+' agent'+(n>1?'s':''),d:'All gates passed. Confirmed individual gap.',b:false,yes:'Generate targeted coaching plan.',no:'N/A — right time for coaching.'}}
  while(gates.length<5)gates.push({s:'pass',l:'—'});return{gates,r:cl};
}
function resetGates(){for(let i=1;i<=5;i++){document.getElementById('g'+i).className='gate';document.getElementById('gs'+i).textContent='—';document.getElementById('gs'+i).className='gate-status pending'}document.getElementById('rw').style.display='flex';document.getElementById('rc').className='result-content'}
function runEngine(){
  if((!isCustom&&selSc<0)||running)return;running=true;document.getElementById('run-btn').disabled=true;resetGates();
  const s=isCustom?buildCustomScenario():scenarios[selSc];let d=0;
  s.gates.forEach((g,i)=>{const gi=i+1;
    setTimeout(()=>{document.getElementById('g'+gi).className='gate checking';document.getElementById('gs'+gi).textContent='CHECKING...'},d);d+=600;
    setTimeout(()=>{const gate=document.getElementById('g'+gi),gs=document.getElementById('gs'+gi);
      if(g.s==='trigger'){gate.className='gate triggered';gs.textContent='⚑ '+g.l;gs.className='gate-status trigger'}
      else if(g.s==='pass'){gate.className='gate passed';gs.textContent='✓ '+g.l;gs.className='gate-status pass'}
      else{gate.className='gate passed';gs.textContent=g.l;gs.className='gate-status pending'}
    },d);d+=300;
  });
  setTimeout(()=>{const r=s.r;document.getElementById('rw').style.display='none';
    let h='<div class="result-class '+r.ct+'">'+r.cl+'</div><div class="result-title">'+r.t+'</div><div class="result-detail">'+r.d+'</div>';
    h+=r.b?'<div class="coaching-blocked">⊘ coaching_blocked = True</div>':r.ct==='individual'?'<div class="coaching-allowed">✓ coaching_plan generated</div>':'';
    h+='<div class="result-action do"><div class="ra-label">✓ Correct Action</div><div class="ra-text">'+r.yes+'</div></div>';
    h+='<div class="result-action dont"><div class="ra-label">✕ Wrong Action</div><div class="ra-text">'+r.no+'</div></div>';
    document.getElementById('rc').innerHTML=h;document.getElementById('rc').className='result-content visible';running=false;document.getElementById('run-btn').disabled=false;
  },d+400);
}

// ═════ COMPOSITE SCORING ═════
let csCleared=false,csMode='full';
const csWeights={full:{Quality:0.25,AHT:0.15,Availability:0.15,Escalation:0.15,Attendance:0.15,Productivity:0.15},partial:{AHT:0.25,Escalation:0.25,Productivity:0.25,'Hold Rate':0.15,ACW:0.10}};
const csColors={Quality:'#fb7185',AHT:'#22d3ee',Availability:'#4ade80',Escalation:'#fbbf24',Attendance:'#c084fc',Productivity:'#f59e0b','Hold Rate':'#818cf8',ACW:'#38bdf8'};
const agents=[
  {n:'Agent A',full:{Quality:82,AHT:75,Availability:88,Escalation:90,Attendance:92,Productivity:85},partial:{AHT:75,Escalation:90,Productivity:85,'Hold Rate':78,ACW:72}},
  {n:'Agent B',full:{Quality:91,AHT:68,Availability:94,Escalation:85,Attendance:88,Productivity:78},partial:{AHT:68,Escalation:85,Productivity:78,'Hold Rate':82,ACW:80}},
  {n:'Agent C',full:{Quality:73,AHT:82,Availability:76,Escalation:55,Attendance:95,Productivity:70},partial:{AHT:82,Escalation:55,Productivity:70,'Hold Rate':60,ACW:65}},
  {n:'Agent D',full:{Quality:88,AHT:90,Availability:82,Escalation:78,Attendance:80,Productivity:92},partial:{AHT:90,Escalation:78,Productivity:92,'Hold Rate':85,ACW:88}},
  {n:'Agent E',full:{Quality:65,AHT:55,Availability:70,Escalation:42,Attendance:72,Productivity:60},partial:{AHT:55,Escalation:42,Productivity:60,'Hold Rate':50,ACW:48}},
  {n:'Agent F',full:{Quality:38,AHT:72,Availability:65,Escalation:70,Attendance:55,Productivity:68},partial:{AHT:72,Escalation:70,Productivity:68,'Hold Rate':75,ACW:70}},
  {n:'Agent G',full:{Quality:95,AHT:45,Availability:90,Escalation:92,Attendance:98,Productivity:88},partial:{AHT:45,Escalation:92,Productivity:88,'Hold Rate':40,ACW:55}},
  {n:'Agent H',full:{Quality:50,AHT:88,Availability:58,Escalation:35,Attendance:60,Productivity:55},partial:{AHT:88,Escalation:35,Productivity:55,'Hold Rate':90,ACW:85}}
];
function calcScore(a){const w=csWeights[csMode],m=a[csMode];let s=0;for(const[k,v]of Object.entries(w))s+=m[k]*v;return Math.round(s)}
function getTier(s){if(s>=70)return{t:'Monitor',c:'monitor'};if(s>=50)return{t:'Coaching',c:'coaching'};if(s>=35)return{t:'Formal PIP',c:'pip'};return{t:'Escalation',c:'escalation'}}
function renderAgents(){
  const grid=document.getElementById('agent-grid'),w=csWeights[csMode],keys=Object.keys(w);
  grid.innerHTML=agents.map(a=>{const score=calcScore(a),tier=getTier(score),m=a[csMode];
    const bars=keys.map(k=>'<div class="ac-bar-seg" style="width:'+w[k]*100+'%;background:'+csColors[k]+'"></div>').join('');
    const tc=tier.c==='monitor'?'var(--success)':tier.c==='coaching'?'var(--warning)':tier.c==='pip'?'var(--error)':'var(--purple)';
    return'<div class="agent-card"><div class="ac-name">'+a.n+'</div><div class="ac-score" style="color:'+tc+'">'+score+'</div><div class="ac-bar">'+bars+'</div><div class="ac-tier '+tier.c+'">'+tier.t+'</div></div>';
  }).join('');
  document.getElementById('cs-legend').innerHTML=keys.map(k=>'<span class="cs-legend-item"><span class="cs-legend-dot" style="background:'+csColors[k]+'"></span>'+k+' '+Math.round(w[k]*100)+'%</span>').join('');
}
function toggleSystemicGate(){
  csCleared=!csCleared;const bar=document.getElementById('cs-gate-bar'),btn=document.getElementById('cs-gate-btn'),st=document.getElementById('cs-gate-status'),pn=document.getElementById('cs-scoring-panel');
  if(csCleared){bar.className='systemic-gate-bar cleared';st.textContent='✓ CLEARED — Environment verified, individual scoring enabled';btn.textContent='Re-Lock Gate';btn.className='sgb-btn block';pn.className='cs-unlocked'}
  else{bar.className='systemic-gate-bar blocked';st.textContent='⊘ BLOCKED — Systemic check required before individual analysis';btn.textContent='Clear Systemic Check';btn.className='sgb-btn clear';pn.className='cs-locked'}
}
function setCSMode(m,el){csMode=m;document.querySelectorAll('.cs-mode-btn').forEach(b=>b.classList.remove('active'));(el||event.target).classList.add('active');renderAgents()}

// ═════ DEMAND FORECASTING ═════
const MVI=[73.3,67.5,72.9,78.0,95.0,109.5,133.3,125.2,114.2,115.2,116.9,98.6];
const DOW=[1.2366,1.1258,1.1052,1.0588,1.0536,0.7995,0.6326];
const MONTHS=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const BASELINE=11072;
function erlangC(N,lambda,aht,slT,waitT){
  const A=lambda*aht;if(N<=0||A<=0)return 0;
  let Bn=1;for(let i=1;i<=N;i++)Bn=(A/i)*Bn/(1+(A/i)*Bn);
  const pw=Bn/(1-(A/N)*(1-Bn));if(pw<0||pw>1)return 0;
  return(1-pw*Math.exp(-(N-A)*(waitT/aht)))*100;
}
function findAgents(arrRate,ahtMin,slT,waitT,shrink){
  const ahtSec=ahtMin*60,lam=arrRate/3600;
  for(let n=1;n<500;n++){if(erlangC(n,lam,ahtSec,slT/100,waitT)>=slT)return Math.ceil(n/(1-shrink/100))}
  return 999;
}
function updateForecast(){
  const mo=+document.getElementById('fc-month').value,gr=+document.getElementById('fc-growth').value,sl=+document.getElementById('fc-sl').value,sh=+document.getElementById('fc-shrink').value,aht=+document.getElementById('fc-aht').value/10,hc=+document.getElementById('fc-hc').value;
  document.getElementById('fc-val-month').textContent=MONTHS[mo];document.getElementById('fc-val-growth').textContent=(gr>=0?'+':'')+gr+'%';document.getElementById('fc-val-sl').textContent=sl+'/120';document.getElementById('fc-val-shrink').textContent=sh+'%';document.getElementById('fc-val-aht').textContent=aht.toFixed(1);document.getElementById('fc-val-hc').textContent=hc;
  const adj=BASELINE*(1+gr/100),wkVol=Math.round(adj*MVI[mo]/100),dayAvg=wkVol/7,peakDay=Math.round(dayAvg*DOW[0]);
  const peakHr=peakDay*0.083,avgHr=dayAvg*(1/24);
  const peakAg=findAgents(peakHr,aht,sl,120,sh),avgAg=findAgents(avgHr,aht,sl,120,sh),gap=hc-peakAg;
  document.getElementById('fc-out-vol').textContent=wkVol.toLocaleString();document.getElementById('fc-out-vol-d').textContent='MVI '+MVI[mo]+' × '+Math.round(adj).toLocaleString();
  document.getElementById('fc-out-peak').textContent=peakDay.toLocaleString();
  document.getElementById('fc-out-agents').textContent=peakAg;document.getElementById('fc-out-agents-d').textContent='Erlang C @ '+sl+'/120';
  document.getElementById('fc-out-avg').textContent=avgAg;
  document.getElementById('fc-out-gap').textContent=(gap>=0?'+':'')+gap+' agents';document.getElementById('fc-out-gap').style.color=gap>=0?'var(--success)':'var(--error)';
  document.getElementById('fc-out-gap-d').textContent=gap>=0?'Surplus at peak hour':'Peak hour deficit vs headcount';
  document.querySelectorAll('.seasonal-bar').forEach((b,i)=>{b.style.height=Math.max(8,MVI[i]/133.3*100)+'%';b.style.background=i===mo?'var(--emerald)':'rgba(16,185,129,0.15)';b.className='seasonal-bar'+(i===mo?' active':'')});
}
function initSeasonal(){document.getElementById('seasonal-chart').innerHTML=MONTHS.map((m,i)=>'<div class="seasonal-bar" style="height:'+Math.max(8,MVI[i]/133.3*100)+'%;background:'+(i===6?'var(--emerald)':'rgba(16,185,129,0.15)')+'"><span class="sb-label">'+m+'</span></div>').join('')}

// ═════ ACCURACY WORKFLOW ═════
const bF=[10800,10200,10600,11100,12800,13500,14200,14800,14200,13400,12800,12600,11900,11200,10800,10400,10100,10600,11000,11400];
const bA=[10500,10400,10300,11400,12500,13800,13900,15100,14500,13100,13000,12200,12100,11000,10600,10200,10300,10800,11200,11100];
let driftOn=false;
function renderAccuracy(){
  const bars=document.getElementById('aw-bars'),f=[...bF],a=driftOn?bA.map((v,i)=>i>=14?Math.round(v*1.18):v):[...bA];
  const mx=Math.max(...f,...a);bars.innerHTML='';
  let tAPE=0,tW=0,tBias=0,con=0,maxC=0;
  for(let i=0;i<20;i++){
    const ape=Math.abs(a[i]-f[i])/a[i]*100,bias=(f[i]-a[i])/a[i]*100;
    tAPE+=ape;tW+=ape*a[i];tBias+=bias;if(ape>15){con++;maxC=Math.max(maxC,con)}else con=0;
    const w=document.createElement('div');w.className='aw-week';
    w.innerHTML='<div class="aw-bar forecast" style="height:'+Math.max(4,f[i]/mx*100)+'%"></div><div class="aw-bar actual" style="height:'+Math.max(4,a[i]/mx*100)+'%"></div><span class="aw-week-label">W'+(i+1)+'</span>';
    if(driftOn&&i>=14){const dz=document.createElement('div');dz.className='aw-drift-zone';dz.style.display='block';dz.style.height='100%';w.appendChild(dz)}
    bars.appendChild(w);
  }
  const mape=(tAPE/20).toFixed(1),wmape=(tW/a.reduce((x,y)=>x+y,0)*100/20).toFixed(1),avgB=(tBias/20).toFixed(1),mad=tAPE/20,ts=mad>0?(tBias/20/mad).toFixed(1):0;
  document.getElementById('aw-mape').textContent=mape+'%';document.getElementById('aw-mape').className='aw-metric-val'+(+mape>12?' alert':'');
  document.getElementById('aw-wmape').textContent=wmape+'%';
  document.getElementById('aw-bias').textContent=(+avgB>=0?'+':'')+avgB+'%';
  document.getElementById('aw-ts').textContent=ts;document.getElementById('aw-ts').className='aw-metric-val'+(Math.abs(ts)>3?' alert':'');
  document.getElementById('aw-alert').className='aw-alert'+(driftOn&&maxC>=4?' visible':'');
}
function toggleDrift(){driftOn=!driftOn;const b=document.getElementById('aw-drift-btn');b.textContent=driftOn?'⚡ Reset to Normal':'⚡ Simulate Structural Drift';b.className='aw-drift-btn'+(driftOn?' active':'');renderAccuracy()}

// ═════ INIT ═════
updateFI();initSeasonal();updateForecast();renderAgents();renderAccuracy();
</script>
</body>
</html>
